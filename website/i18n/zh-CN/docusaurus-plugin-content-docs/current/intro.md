---
sidebar_position: 1
title: ç®€ä»‹
---

> è¿™æ˜¯ä¸€ä¸ªå®ç°äº†ç±»ä¼¼[vue](https://vuejs.org/)ä¸­æä¾›çš„([keep-alive](https://vuejs.org/v2/guide/components-dynamic-async.html#keep-alive))åŠŸèƒ½çš„ç»„ä»¶.æœŸæœ›è®©ç»„ä»¶è¾¾åˆ°**ç›¸å¯¹é™æ­¢**çš„æ•ˆæœ(å¹¶ä¸æ˜¯å†»ç»“ï¼Œä»…ä»…åªæ˜¯ä¿æŒå³æ—¶çŠ¶æ€)

![React-stillness-component intro img](/img/intro.gif)

:::info

åœ¨å®ç°çš„è¿‡ç¨‹ä¸­ä»ç¤¾åŒºå¸å–äº†å¾ˆå¤šä¼˜ç§€çš„ç»éªŒï¼Œæ¯”å¦‚ [issue #12039](https://github.com/facebook/react/issues/12039)ï¼Œ [react-18 Offscreen](https://github.com/reactwg/react-18/discussions/19)ï¼Œ [åœ¨ React ä¸­å®ç° keep alive](https://zhuanlan.zhihu.com/p/214166951) ç­‰ï¼Œå†ç»“åˆè‡ªå·±çš„å®é™…ä¸šåŠ¡åœºæ™¯ï¼Œæœ€ç»ˆä½¿ç”¨äº† [React.createPortal API](https://reactjs.org/docs/portals.html) ä¸ [redux](https://redux.js.org/) å®ç°äº†è¿™ä¸€ç»„ä»¶.

:::

## âœ¨ ç‰¹ç‚¹

- **æç®€è¯­æ³•**ï¼Œæœ€å°‘ä»…éœ€ä¸€ä¸ª prop
- **æ›´æ–°åŠæ—¶**ï¼Œæä¾› `Higher-Order Component` ä»¥åŠ `Hooks` æ–¹å¼ç®¡ç†ç»„ä»¶
- **ä½å­¦ä¹ æˆæœ¬**ï¼Œæ²¡æœ‰é¢å¤–çš„ç”Ÿå‘½å‘¨æœŸæ¦‚å¿µï¼Œä¸ä¼šå½±å“ç»„ä»¶çš„ç»„åˆ
- **æœ€å°å½±å“**ï¼Œä¸ä¼šå½±å“ react ç›¸å…³ apiï¼ŒåŒ…æ‹¬ Contextã€Error Boundaries ç­‰ï¼Œç”šè‡³æ˜¯ SyntheticEvent
- **æ€§èƒ½ä¼˜å…ˆ**ï¼Œè‡ªåŠ¨æ‡’æƒ°åŠ è½½ï¼Œæé«˜æ•´ä½“åº”ç”¨æ€§èƒ½

## ğŸ’¡ åšäº†ä»€ä¹ˆ?

é¦–å…ˆï¼Œè¿™ä¸ªç»„ä»¶ä¸ä»…ä»…åªæ˜¯ä¸ºäº†è¾¾åˆ°ç¼“å­˜ç»„ä»¶çš„æ•ˆæœï¼ŒåŒæ—¶ä¹Ÿè¦è§£å†³ç¼“å­˜æ§åˆ¶çš„é—®é¢˜

- **Portal** å¯ä»¥åšåˆ°**å°†ç»„ä»¶æ¸²æŸ“åˆ°å±å¹•ä¹‹å¤–**.
- **Redux** å¯ä»¥å¸®åŠ©æˆ‘ä»¬ä¿å­˜å®æ—¶çš„ç¼“å­˜çŠ¶æ€

:::info

è¯¥ç»„ä»¶å¹¶ä¸æä¾›é¢å¤–çš„ç”Ÿå‘½å‘¨æœŸçš„é’©å­æ¥è§£å†³å­ç»„ä»¶ç›‘å¬ç¼“å­˜çš„çŠ¶æ€.è€Œæ˜¯é€šè¿‡ç±»ä¼¼[react DnD Monitors](https://react-dnd.github.io/react-dnd/docs/overview#monitors)çš„æ–¹å¼å°†ç¼“å­˜çŠ¶æ€ä¸ä¸šåŠ¡çŠ¶æ€ç›¸ç»“åˆï¼Œè‡ªå®šä¹‰å‘ä¸‹ä¼ é€’çš„ **children props** ï¼Œä¹Ÿæ˜¯ä¸€ç§å¢å¼ºç»„ä»¶å¯ç»„åˆæ€§çš„æ–¹å¼.

:::

### æ•°æ®çŠ¶æ€é©±åŠ¨

é’ˆå¯¹ç¼“å­˜æ§åˆ¶ï¼Œè¯¥ç»„ä»¶æä¾›äº† [Types](basic-concepts/items-types.md#Types) çš„å½¢å¼ï¼Œæ¥æ ‡è¯†æŸä¸€ä¸ªç”šè‡³ä¸€æ‰¹ç»„ä»¶ï¼Œæ¥æŒ‡å®šæŸä¸€ç±»å‹çš„ç¼“å­˜ç»„ä»¶å¹¶è¿›è¡Œåˆ†ç±».å½“ç„¶ï¼Œè¿™ä¸æ˜¯å¿…é¡»é¡¹.

å®é™…ä¸Šï¼Œç»„ä»¶å†…éƒ¨ä¹Ÿæä¾›äº†å”¯ä¸€æ€§ idï¼Œç”¨äºæ ‡è¯†ç»„ä»¶ï¼Œä¸¤è€…ä½œç”¨å®é™…ä¸Šæ˜¯ä¸€è‡´çš„.æƒ³åœ¨ç»„ä»¶å†…éƒ¨è·å– idï¼Œè¯·å‚è€ƒ [getStillnessId()](api/contract-state.md) .

### DOM æ“ä½œ

![DOMæ“ä½œ](/img/real-dom.png)

è¯¥ç»„ä»¶ä¸º`children`æä¾›äº†ä¸€ä¸ªå®šä½å…ƒç´ ï¼Œå³ä¸Šå›¾ä¸­çš„`[data-key="__stillness-uniqueId**__"]`èŠ‚ç‚¹.

ä»¥åŠ`Portal`æ‰€éœ€çš„**container**å…ƒç´ ï¼Œå³ä¸Šå›¾ä¸­çš„`[data-key="offscreen-wrapper"]`èŠ‚ç‚¹.

æ¯æ¬¡**é™æ­¢**ä¸å¦å®é™…ä¸Šä¼šåšä¸€æ¬¡ dom æ“ä½œï¼Œç§»é™¤**container**å…ƒç´ æˆ–æ’å…¥è¯¥å…ƒç´ ï¼Œè¾¾åˆ°æ˜¾ç¤ºä¸éšè—çš„ UI æ•ˆæœ.åŒæ—¶æ¯æ¬¡å¼€å§‹**é™æ­¢**æ—¶ï¼Œå¦‚æœ`children`ä¸­æœ‰å¯æ»šåŠ¨çš„å…ƒç´ ï¼Œä¹Ÿä¼šè‡ªåŠ¨ä¿å­˜å…¶æ»šåŠ¨ä½ç½®(é»˜è®¤ä¸º true)

### react API

å› ä¸ºä½¿ç”¨äº†`Portal`ï¼Œå³ä½¿çœŸå® dom å…ƒç´ è¢«ç§»é™¤æˆ–ç§»å…¥ï¼Œä½†ç»„ä»¶ä»ç„¶å¯ä»¥è¿›è¡Œäº‹ä»¶å†’æ³¡ä»¥åŠç›¸åº”å…¶ä»–`react`ç›¸å…³ apiï¼Œå¹¶ä¸æ™®é€šç»„ä»¶è¡Œä¸ºä¸€è‡´.

### typescript

ç»„ä»¶ç›®å‰ä½¿ç”¨**typescript**è¿›è¡Œå¼€å‘ï¼Œç›¸å…³çš„ç±»å‹å®šä¹‰è¯·å‚è€ƒ[Typescript æ”¯æŒ](get-started.md#typescript-support).

### å…¼å®¹æ€§

- React v16.8+
- Preact v10+

<!-- ### é›†æˆ

- **react-router** è¯·å‚è€ƒ[type](#getType)
- **umijs** è¯·å‚è€ƒ[type](#getType)
- **nextjs** è¯·å‚è€ƒ[type](#getType) -->
