<?xml version="1.0" encoding="utf-8"?>
<feed xmlns="http://www.w3.org/2005/Atom">
    <id>https://leomyili.github.io/react-stillness-component/zh-CN/blog</id>
    <title>React-stillness-component Blog</title>
    <updated>2022-09-24T13:20:00.000Z</updated>
    <generator>https://github.com/jpmonette/feed</generator>
    <link rel="alternate" href="https://leomyili.github.io/react-stillness-component/zh-CN/blog"/>
    <subtitle>React-stillness-component Blog</subtitle>
    <icon>https://leomyili.github.io/react-stillness-component/zh-CN/img/favicon.ico</icon>
    <entry>
        <title type="html"><![CDATA[ç”¨TDDçš„æ€æƒ³åšç»„ä»¶æµ‹è¯•]]></title>
        <id>tdd-test</id>
        <link href="https://leomyili.github.io/react-stillness-component/zh-CN/blog/tdd-test"/>
        <updated>2022-09-24T13:20:00.000Z</updated>
        <summary type="html"><![CDATA[è¿™æ˜¯æˆ‘å…³äºå‰ç«¯è‡ªåŠ¨åŒ–æµ‹è¯•çš„ç¬¬ä¸€ç¯‡åšæ–‡ã€‚]]></summary>
        <content type="html"><![CDATA[<blockquote><p>Test-Driven Development(æµ‹è¯•é©±åŠ¨å¼€å‘,ä»¥ä¸‹ç®€è¿°<strong>TDD</strong>)æ˜¯ä¸€ç§è®¾è®¡æ–¹æ³•è®º, åŸç†æ˜¯åœ¨å¼€å‘åŠŸèƒ½ä»£ç ä¹‹å‰, å…ˆç¼–å†™å•å…ƒæµ‹è¯•ç”¨ä¾‹ä»£ç , é€šè¿‡æµ‹è¯•æ¥æ¨åŠ¨æ•´ä¸ªå¼€å‘çš„è¿›è¡Œ.</p></blockquote><p>æœ¬æ–‡è¯¦ç»†æè¿°äº†åœ¨åˆ›ä½œ <code>react-stillness-component</code> ç»„ä»¶çš„è¿‡ç¨‹ä¸­, æ˜¯å¦‚ä½•å­¦ä¹  <strong>TDD</strong> çš„æ€æƒ³æ¥å®ŒæˆåŠŸèƒ½å¼€å‘ä»¥åŠæµ‹è¯•çš„.å…³äºç»„ä»¶å®ç°çš„åŸç†ä»¥åŠç»†èŠ‚,å¯ä»¥æŸ¥çœ‹ä¸Šä¸€ç¯‡æ–‡ç«  ã€Šreact ä¸­å¦‚ä½•å®ç° keep-alive æ•ˆæœã€‹</p><h2 class="anchor anchorWithHideOnScrollNavbar_R0VQ" id="ä¸€å‰è¨€-è‡ªåŠ¨åŒ–æµ‹è¯•ç›¸å…³">ä¸€.å‰è¨€-è‡ªåŠ¨åŒ–æµ‹è¯•ç›¸å…³<a class="hash-link" href="#ä¸€å‰è¨€-è‡ªåŠ¨åŒ–æµ‹è¯•ç›¸å…³" title="Direct link to heading">â€‹</a></h2><p>æœ¬ç¯‡æ–‡ç« æ˜¯é’ˆå¯¹ç¼–å†™<code>react</code>ç»„ä»¶è¿‡ç¨‹ä¸­æ‰€äº§ç”Ÿçš„è´¨é‡ä¸åŠŸèƒ½ä¿éšœçš„è§’åº¦å»å†™çš„,ç”±äºæ¶‰åŠåˆ°éƒ¨åˆ†çš„åè¯,å¯èƒ½éœ€è¦æå‰æœ‰éƒ¨åˆ†çš„è‡ªåŠ¨åŒ–æµ‹è¯•ç›¸å…³çŸ¥è¯†;</p><p>æœ¬æ–‡çš„ä¾§é‡ç‚¹ä¸»è¦æ˜¯åœ¨å¦‚ä½•è®¾è®¡ä»¥åŠä¸ºä½•è¦ä½¿ç”¨ tdd çš„æ–¹å¼æ¥åšç»„ä»¶æµ‹è¯•,æœ‰ä»»ä½•çš„é—®é¢˜,ä¹Ÿæ¬¢è¿ä¸ä½œè€…è¿›è¡Œè®¨è®º ğŸ˜</p><h2 class="anchor anchorWithHideOnScrollNavbar_R0VQ" id="äºŒæˆ‘æ‰€è®¤ä¸ºçš„-tdd-å®é™…è½åœ°æµç¨‹">äºŒ.æˆ‘æ‰€è®¤ä¸ºçš„ tdd å®é™…è½åœ°æµç¨‹<a class="hash-link" href="#äºŒæˆ‘æ‰€è®¤ä¸ºçš„-tdd-å®é™…è½åœ°æµç¨‹" title="Direct link to heading">â€‹</a></h2><p>é¦–å…ˆç®€å•å›é¡¾ä¸€ä¸‹ tdd:</p><p><img loading="lazy" alt="tdd" src="/react-stillness-component/zh-CN/assets/images/10-b292ff3f70bb662646bd2af62c16decb.png" width="1488" height="961" class="img_E7b_"></p><p>å¯¹åº”çš„å®é™…è¡Œä¸ºå¯èƒ½æ˜¯(<a href="https://en.wikipedia.org/wiki/Test-driven_development" target="_blank" rel="noopener noreferrer">æ¥æºäº wiki</a>)</p><ol><li>æ·»åŠ ä¸€ä¸ªæµ‹è¯•ç”¨ä¾‹</li><li>è¿è¡Œè¯¥æµ‹è¯•ç”¨ä¾‹,å¾—åˆ°å¤±è´¥çš„ç»“æœ(å› ä¸ºè¿˜æ²¡æœ‰å®ç°ä»»ä½•åŠŸèƒ½)</li><li>ç¼–å†™åˆšå¥½èƒ½é€šè¿‡çš„æœ€ç®€å•çš„ä»£ç </li><li>é‡æ–°è¿è¡Œè¯¥æµ‹è¯•ç”¨ä¾‹,å¾—åˆ°æˆåŠŸçš„ç»“æœ</li><li>æ ¹æ®éœ€è¦è¿›è¡Œé‡æ„,å¹¶ä¿è¯æ¯æ¬¡é‡æ„ä¹‹åéƒ½èƒ½é€šè¿‡ä¹‹å‰çš„æµ‹è¯•ç”¨ä¾‹</li><li>é‡å¤è¿™ä¸ªæ­¥éª¤,ç›´è‡³å®Œæˆæ•´ä¸ªå¼€å‘</li></ol><p>å½“ç„¶,åœ¨å®é™…çš„å¼€å‘è¿‡ç¨‹ä¸­,ä½œè€…ä¹Ÿé’ˆå¯¹ç°å®æƒ…å†µåšäº†ä¸€å®šçš„æ”¹é€ ,å…ˆçœ‹ä¸‹æ”¹é€ ä¹‹åçš„æµç¨‹:</p><p><img loading="lazy" alt="new flow" src="/react-stillness-component/zh-CN/assets/images/11-bfe3dbd86b3d6ec48491d08c4dd9576c.png" width="1488" height="2446" class="img_E7b_"></p><p>è¿™é‡Œä¸»è¦æ˜¯é’ˆå¯¹å‰ç«¯ç»„ä»¶åœºæ™¯å¢åŠ äº†ä¸€äº›æ¯”è¾ƒé‡è¦çš„æ­¥éª¤</p><ul><li>ç¡®è®¤ç”¨æˆ·åœºæ™¯,åœ¨ä»€ä¹ˆæ ·çš„æƒ…å†µä¸‹æ‰è€ƒè™‘ç”¨åˆ°è¿™ä¸ªç»„ä»¶?åŒ…æ‹¬äº†æ™®é€šç”¨æˆ·å’Œä¸“ä¸šç”¨æˆ·æ¶‰åŠåˆ°çš„åœºæ™¯.éœ€è¦è€ƒè™‘åˆ°æ¶‰åŠåˆ° UI æ¡†æ¶çš„åœºæ™¯</li><li>ç¡®è®¤ç”¨æˆ·è¡Œä¸º,ä¹Ÿå°±æ˜¯ç”¨æˆ·çš„å…·ä½“æ“ä½œæ˜¯ä»€ä¹ˆ?å¯ä»¥å…ˆä»è‡ªèº«çš„è§’åº¦å‡ºå‘,å†è¿›è¡Œå®é™…è°ƒç ”,è§‚å¯Ÿç±»ä¼¼çš„ç»„ä»¶æ˜¯å¦‚ä½•è¢«ä½¿ç”¨çš„</li><li>ç¡®è®¤ç”¨æˆ·ç¯å¢ƒ,è¿™é‡Œçš„ç¯å¢ƒåŒ…æ‹¬äº†ç°ä»£æµè§ˆå™¨ç¯å¢ƒä»¥åŠæ¡†æ¶è‡ªèº«æ‰€å¤„çš„å¼€å‘ç¯å¢ƒ.</li></ul><p>åœ¨æ¯æ¬¡å®Œæˆæµ‹è¯•ç”¨ä¾‹ç¼–å†™ä¹‹å‰å…ˆæ˜¯ç¡®è®¤ç¯èŠ‚,ä¿è¯åŠŸèƒ½ä¸åç¦»åˆå¿ƒ;åœ¨æ¯æ¬¡æµ‹è¯•å®Œä¹‹å,å†è¿›è¡ŒéªŒè¯,è€ŒéªŒè¯çš„æ‰‹æ®µå¯ä»¥æ˜¯ BDD(åæ–‡ä¼šæåˆ°)ä¹Ÿå¯ä»¥ç»“åˆç°å®çº¿ä¸Šä¾‹å­è¿›è¡Œç»“åˆè€ƒè™‘,å¦‚æœå¯ä»¥è§£å†³å®é™…é—®é¢˜,åˆ™è¯æ˜åŠŸèƒ½å·²å®Œæˆ.</p><p>å½“ç„¶,ç”±äºä½œè€…æœ¬èº«çš„æ—¥å¸¸ä¹ æƒ¯æ˜¯å…ˆåˆ—è®¡åˆ’ ğŸ˜‚,è¿™æ¬¡ä¹Ÿä¸ä¾‹å¤–:</p><p><img loading="lazy" alt="mind node1" src="/react-stillness-component/zh-CN/assets/images/12-3e670b5914cec369cddaf409f58631ce.png" width="3304" height="5486" class="img_E7b_"></p><p>å¯ä»¥çœ‹åˆ°æœ€ä¸‹é¢çš„éƒ¨åˆ†å°±æ˜¯ä¸ TDD ç›¸å…³çš„æµ‹è¯•ç”¨ä¾‹è§„åˆ’,å®é™…ç¼–å†™ç”¨ä¾‹è¿‡ç¨‹ä¸­ä¼šæœ‰é¢å¤–çš„æƒ…å†µ,å› æ­¤ç¬¬äºŒä¸ªéƒ¨åˆ†ä¹Ÿå°±æ˜¯ e2e æ¨¡æ‹Ÿæµ‹è¯•å°±æ˜¯æ¡†å®šçš„ä½¿ç”¨èŒƒå›´,ç¬¬ä¸€æœŸåªè¦ä¸è¶…å‡ºå³å¯.</p><p>ä¸‹é¢æ¥çœ‹å®é™…æ¡ˆä¾‹</p><h2 class="anchor anchorWithHideOnScrollNavbar_R0VQ" id="ä¸‰å®é™…æ¡ˆä¾‹">ä¸‰.å®é™…æ¡ˆä¾‹<a class="hash-link" href="#ä¸‰å®é™…æ¡ˆä¾‹" title="Direct link to heading">â€‹</a></h2><blockquote><p>æœ¬æ–‡ä¸­ä½¿ç”¨çš„æµ‹è¯•æ¡†æ¶ä¸º<strong><a href="https://jestjs.io/" target="_blank" rel="noopener noreferrer">jest</a></strong>,ç›¸å…³é…ç½®å¯å‚è€ƒé—®é¢˜æ±‡æ€»çš„ç¬¬ä¸€ç‚¹</p></blockquote><h3 class="anchor anchorWithHideOnScrollNavbar_R0VQ" id="provider">provider<a class="hash-link" href="#provider" title="Direct link to heading">â€‹</a></h3><p>é¦–å…ˆä»æœ€å¤–å±‚å¼€å§‹,è¯¥ç»„ä»¶å†…éƒ¨å¤§é‡ä½¿ç”¨äº†<code>context</code>,å› æ­¤,éœ€è¦æä¾›ä¸€ä¸ªå…¨å±€çš„<code>provider</code>,å› ä¸º<code>provider</code>çš„<code>value</code>æ¥æºäº<code>createStillnessManager()</code>,æ‰€ä»¥æˆ‘ä»¬çš„ç¬¬ä¸€ä¸ªä¾‹å­å°±æ˜¯åˆ¤æ–­å½“æä¾›äº†è¿™ä¸ªæ–¹æ³•çš„æ—¶å€™,<code>provider</code>æ˜¯å¦å¯ä»¥æ­£å¸¸è¿è¡Œ</p><div class="codeBlockContainer_X7hc language-js theme-code-block"><div class="codeBlockContent_vqWU" style="color:#393A34;background-color:#f6f8fa"><pre tabindex="0" class="prism-code language-js codeBlock_wPnj thin-scrollbar"><code class="codeBlockLines_fQUY"><span class="token-line" style="color:#393A34"><span class="token function" style="color:#d73a49">it</span><span class="token punctuation" style="color:#393A34">(</span><span class="token string" style="color:#e3116c">'Verify that the StillnessManager is correct'</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">(</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"> </span><span class="token arrow operator" style="color:#393A34">=&gt;</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token keyword" style="color:#00009f">let</span><span class="token plain"> capturedManager</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token keyword" style="color:#00009f">let</span><span class="token plain"> manager </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> </span><span class="token function" style="color:#d73a49">createStillnessManager</span><span class="token punctuation" style="color:#393A34">(</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"> </span><span class="token comment" style="color:#999988;font-style:italic">// let mockManager: any = jest.fn();</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token function" style="color:#d73a49">render</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token operator" style="color:#393A34">&lt;</span><span class="token maybe-class-name">StillnessContext</span><span class="token punctuation" style="color:#393A34">.</span><span class="token property-access maybe-class-name">Provider</span><span class="token plain"> value</span><span class="token operator" style="color:#393A34">=</span><span class="token punctuation" style="color:#393A34">{</span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"> </span><span class="token literal-property property" style="color:#36acaa">stillnessManager</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> manager </span><span class="token punctuation" style="color:#393A34">}</span><span class="token punctuation" style="color:#393A34">}</span><span class="token operator" style="color:#393A34">&gt;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      </span><span class="token operator" style="color:#393A34">&lt;</span><span class="token maybe-class-name">StillnessContext</span><span class="token punctuation" style="color:#393A34">.</span><span class="token property-access maybe-class-name">Consumer</span><span class="token operator" style="color:#393A34">&gt;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token punctuation" style="color:#393A34">{</span><span class="token punctuation" style="color:#393A34">(</span><span class="token parameter punctuation" style="color:#393A34">{</span><span class="token parameter"> stillnessManager </span><span class="token parameter punctuation" style="color:#393A34">}</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"> </span><span class="token arrow operator" style="color:#393A34">=&gt;</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">          capturedManager </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> stillnessManager</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">          </span><span class="token keyword control-flow" style="color:#00009f">return</span><span class="token plain"> </span><span class="token keyword null nil" style="color:#00009f">null</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token punctuation" style="color:#393A34">}</span><span class="token punctuation" style="color:#393A34">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      </span><span class="token operator" style="color:#393A34">&lt;</span><span class="token operator" style="color:#393A34">/</span><span class="token maybe-class-name">StillnessContext</span><span class="token punctuation" style="color:#393A34">.</span><span class="token property-access maybe-class-name">Consumer</span><span class="token operator" style="color:#393A34">&gt;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token operator" style="color:#393A34">&lt;</span><span class="token operator" style="color:#393A34">/</span><span class="token maybe-class-name">StillnessContext</span><span class="token punctuation" style="color:#393A34">.</span><span class="token property-access maybe-class-name">Provider</span><span class="token operator" style="color:#393A34">&gt;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token function" style="color:#d73a49">expect</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">capturedManager</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">.</span><span class="token method function property-access" style="color:#d73a49">toBe</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">manager</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token punctuation" style="color:#393A34">}</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">;</span><br></span></code></pre><button type="button" aria-label="Copy code to clipboard" title="Copy" class="copyButton_eDfN clean-btn"><span class="copyButtonIcons_W9eQ" aria-hidden="true"><svg class="copyButtonIcon_XEyF" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_i9w9" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div><p>è¿™é‡Œå‰æœŸä½¿ç”¨çš„å…¶å®æ˜¯<code>jest mock functions</code>,å½“<code>createStillnessManager()</code>ç¼–å†™å®Œæˆä¹‹å,æ‰è¢«æ›¿æ¢æˆçœŸå®çš„å‡½æ•°,ä¸¤è€…çš„åŒºåˆ«åœ¨äº<code>mock</code>çš„æ–¹å¼å¯ä»¥è¿‡æ»¤æ‰<code>provider</code>ç¼–å†™ä»£ç æ—¶çš„å¹²æ‰°é¡¹</p><p>é‚£æˆ‘ä»¬ç°åœ¨å°±å¯ä»¥å¼€å§‹ <code>run test</code> äº†,å½“ç„¶,è¿™æ—¶ç”±äºä»£ç å·²ç¼–å†™å®Œæ¯•,æ— è®ºæ˜¯ä½¿ç”¨çœŸå®çš„å‚æ•°è¿˜æ˜¯æ¨¡æ‹Ÿçš„å‚æ•°éƒ½å¯ä»¥å¾—åˆ°æˆåŠŸçš„ä¾‹å­.</p><p>è€Œåœ¨ä¸€å¼€å§‹,æœªç¼–å†™ä»£ç æ—¶,å°±å¯ä»¥éµå¾ªæµç¨‹,ç¼–å†™çœŸå®ä»£ç äº†.</p><p><code>provider</code>é™¤äº†åˆå§‹åŒ–ä¹‹å¤–,å½“ç„¶è¿˜ä¼šæœ‰å…¶ä»–åŠŸèƒ½,æ¯”å¦‚:</p><ul><li>å¸è½½æ—¶ä¼šè‡ªåŠ¨æ¸…é™¤å…¨å±€çš„ç¼“å­˜å¯¹è±¡</li><li>é¢„é˜²å¤šä¸ª provider åµŒå¥—äº§ç”Ÿçš„é”™è¯¯,éœ€è¦ä¸»åŠ¨æé†’ç”¨æˆ·</li></ul><p>è€Œé’ˆå¯¹è¿™ä¸¤ç‚¹,æˆ‘ä»¬å°±å¯ä»¥ç»§ç»­å†™æµ‹è¯•ç”¨ä¾‹äº†</p><div class="codeBlockContainer_X7hc language-js theme-code-block"><div class="codeBlockContent_vqWU" style="color:#393A34;background-color:#f6f8fa"><pre tabindex="0" class="prism-code language-js codeBlock_wPnj thin-scrollbar"><code class="codeBlockLines_fQUY"><span class="token-line" style="color:#393A34"><span class="token function" style="color:#d73a49">it</span><span class="token punctuation" style="color:#393A34">(</span><span class="token string" style="color:#e3116c">'stores StillnessManager in global context and cleans up on unmount'</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">(</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"> </span><span class="token arrow operator" style="color:#393A34">=&gt;</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token keyword" style="color:#00009f">let</span><span class="token plain"> capturedManager</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token keyword" style="color:#00009f">const</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"> container</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> unmount </span><span class="token punctuation" style="color:#393A34">}</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> </span><span class="token function" style="color:#d73a49">render</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token operator" style="color:#393A34">&lt;</span><span class="token maybe-class-name">StillnessProvider</span><span class="token operator" style="color:#393A34">&gt;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      </span><span class="token operator" style="color:#393A34">&lt;</span><span class="token maybe-class-name">StillnessContext</span><span class="token punctuation" style="color:#393A34">.</span><span class="token property-access maybe-class-name">Consumer</span><span class="token operator" style="color:#393A34">&gt;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token punctuation" style="color:#393A34">{</span><span class="token punctuation" style="color:#393A34">(</span><span class="token parameter punctuation" style="color:#393A34">{</span><span class="token parameter"> stillnessManager </span><span class="token parameter punctuation" style="color:#393A34">}</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"> </span><span class="token arrow operator" style="color:#393A34">=&gt;</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">          capturedManager </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> stillnessManager</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">          </span><span class="token keyword control-flow" style="color:#00009f">return</span><span class="token plain"> </span><span class="token keyword null nil" style="color:#00009f">null</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token punctuation" style="color:#393A34">}</span><span class="token punctuation" style="color:#393A34">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      </span><span class="token operator" style="color:#393A34">&lt;</span><span class="token operator" style="color:#393A34">/</span><span class="token maybe-class-name">StillnessContext</span><span class="token punctuation" style="color:#393A34">.</span><span class="token property-access maybe-class-name">Consumer</span><span class="token operator" style="color:#393A34">&gt;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token operator" style="color:#393A34">&lt;</span><span class="token operator" style="color:#393A34">/</span><span class="token maybe-class-name">StillnessProvider</span><span class="token operator" style="color:#393A34">&gt;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token keyword" style="color:#00009f">const</span><span class="token plain"> </span><span class="token function-variable function" style="color:#d73a49">globalInstance</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">(</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"> </span><span class="token arrow operator" style="color:#393A34">=&gt;</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">global </span><span class="token keyword module" style="color:#00009f">as</span><span class="token plain"> any</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">[</span><span class="token constant" style="color:#36acaa">INSTANCE_SYM</span><span class="token punctuation" style="color:#393A34">]</span><span class="token plain"> </span><span class="token keyword module" style="color:#00009f">as</span><span class="token plain"> any</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token function" style="color:#d73a49">expect</span><span class="token punctuation" style="color:#393A34">(</span><span class="token function" style="color:#d73a49">globalInstance</span><span class="token punctuation" style="color:#393A34">(</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">.</span><span class="token property-access">stillnessManager</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">.</span><span class="token method function property-access" style="color:#d73a49">toEqual</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">capturedManager</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token function" style="color:#d73a49">unmount</span><span class="token punctuation" style="color:#393A34">(</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token function" style="color:#d73a49">expect</span><span class="token punctuation" style="color:#393A34">(</span><span class="token function" style="color:#d73a49">globalInstance</span><span class="token punctuation" style="color:#393A34">(</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">.</span><span class="token method function property-access" style="color:#d73a49">toEqual</span><span class="token punctuation" style="color:#393A34">(</span><span class="token keyword null nil" style="color:#00009f">null</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token punctuation" style="color:#393A34">}</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">;</span><br></span></code></pre><button type="button" aria-label="Copy code to clipboard" title="Copy" class="copyButton_eDfN clean-btn"><span class="copyButtonIcons_W9eQ" aria-hidden="true"><svg class="copyButtonIcon_XEyF" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_i9w9" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div><p>å¯ä»¥çœ‹åˆ°,è¿™é‡Œé€šè¿‡è°ƒç”¨è¿”å›çš„æ–¹æ³•,ä»è€Œè¾¾åˆ°äº†æ¨¡æ‹Ÿå¸è½½çš„æ•ˆæœ.</p><h3 class="anchor anchorWithHideOnScrollNavbar_R0VQ" id="class-component">class Component<a class="hash-link" href="#class-component" title="Direct link to heading">â€‹</a></h3><p>é¦–å…ˆæ¥çœ‹ä¸‹æ•´ä¸ªåº“çš„æ ¸å¿ƒ, <code>&lt;OffscreeenComponent&gt;</code>,ç›¸æ¯”è¾ƒç»è¿‡<code>HOC</code>åŒ…è£…ä¹‹åçš„ç»„ä»¶,åŸå§‹ç»„ä»¶çš„ props å°±è¦å¤æ‚çš„å¤šäº†</p><ul><li>uniqueId: UniqueId;</li><li>parentId: UniqueId;</li><li>parentIsStillness: boolean;</li><li>isStillness: boolean;</li><li>stillnessManager: StillnessManager;</li></ul><p>æµ‹è¯•ç”¨ä¾‹ä¹Ÿå›´ç»•è¿™å‡ ç‚¹å³å¯,ä¸¾ä¸ªä¾‹å­:</p><div class="codeBlockContainer_X7hc language-js theme-code-block"><div class="codeBlockContent_vqWU" style="color:#393A34;background-color:#f6f8fa"><pre tabindex="0" class="prism-code language-js codeBlock_wPnj thin-scrollbar"><code class="codeBlockLines_fQUY"><span class="token-line" style="color:#393A34"><span class="token function" style="color:#d73a49">it</span><span class="token punctuation" style="color:#393A34">(</span><span class="token string" style="color:#e3116c">'Does it prompt an error message when there is no context?'</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">(</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"> </span><span class="token arrow operator" style="color:#393A34">=&gt;</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  global</span><span class="token punctuation" style="color:#393A34">.</span><span class="token property-access">console</span><span class="token punctuation" style="color:#393A34">.</span><span class="token property-access">error</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> jest</span><span class="token punctuation" style="color:#393A34">.</span><span class="token method function property-access" style="color:#d73a49">fn</span><span class="token punctuation" style="color:#393A34">(</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token function" style="color:#d73a49">expect</span><span class="token punctuation" style="color:#393A34">(</span><span class="token punctuation" style="color:#393A34">(</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"> </span><span class="token arrow operator" style="color:#393A34">=&gt;</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token function" style="color:#d73a49">render</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      </span><span class="token operator" style="color:#393A34">&lt;</span><span class="token maybe-class-name">OffscreenComponent</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        visible</span><span class="token operator" style="color:#393A34">=</span><span class="token punctuation" style="color:#393A34">{</span><span class="token boolean" style="color:#36acaa">true</span><span class="token punctuation" style="color:#393A34">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        isStillness</span><span class="token operator" style="color:#393A34">=</span><span class="token punctuation" style="color:#393A34">{</span><span class="token boolean" style="color:#36acaa">false</span><span class="token punctuation" style="color:#393A34">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        uniqueId</span><span class="token operator" style="color:#393A34">=</span><span class="token string" style="color:#e3116c">"test1"</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        parentId</span><span class="token operator" style="color:#393A34">=</span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain">rootId</span><span class="token punctuation" style="color:#393A34">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        parentIsStillness</span><span class="token operator" style="color:#393A34">=</span><span class="token punctuation" style="color:#393A34">{</span><span class="token boolean" style="color:#36acaa">false</span><span class="token punctuation" style="color:#393A34">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      </span><span class="token operator" style="color:#393A34">&gt;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token operator" style="color:#393A34">&lt;</span><span class="token plain">div </span><span class="token operator" style="color:#393A34">/</span><span class="token operator" style="color:#393A34">&gt;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      </span><span class="token operator" style="color:#393A34">&lt;</span><span class="token operator" style="color:#393A34">/</span><span class="token maybe-class-name">OffscreenComponent</span><span class="token operator" style="color:#393A34">&gt;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token punctuation" style="color:#393A34">}</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">.</span><span class="token method function property-access" style="color:#d73a49">toThrow</span><span class="token punctuation" style="color:#393A34">(</span><span class="token regex regex-delimiter" style="color:#36acaa">/</span><span class="token regex regex-source language-regex" style="color:#36acaa">stillnessManager is required</span><span class="token regex regex-delimiter" style="color:#36acaa">/</span><span class="token regex regex-flags" style="color:#36acaa">i</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token punctuation" style="color:#393A34">}</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">;</span><br></span></code></pre><button type="button" aria-label="Copy code to clipboard" title="Copy" class="copyButton_eDfN clean-btn"><span class="copyButtonIcons_W9eQ" aria-hidden="true"><svg class="copyButtonIcon_XEyF" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_i9w9" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div><p>ç»„ä»¶æ˜¯æ²¡åŠæ³•åœ¨ç¼ºå°‘ <code>context</code> çš„æƒ…å†µä¸‹è¿è¡Œçš„,é‚£æˆ‘ä»¬åœ¨ç¼–å†™ä¾‹å­çš„æ—¶å€™åªè¦æ’é™¤è¿™ä¸ªå‚æ•°å°±è¡Œ,å¦‚æœç»„ä»¶æ•è·äº†å¼‚å¸¸å¹¶æŠ›å‡ºäº†,åˆ™è¯´æ˜åŠŸèƒ½æ˜¯ ok çš„,è¿™ä¸ªå±äºè¾ƒä¸ºç®€å•çš„ä¾‹å­</p><p>æ¥çœ‹ä¸€ä¸ªæ›´åŠ å¤æ‚çš„:</p><div class="codeBlockContainer_X7hc language-js theme-code-block"><div class="codeBlockContent_vqWU" style="color:#393A34;background-color:#f6f8fa"><pre tabindex="0" class="prism-code language-js codeBlock_wPnj thin-scrollbar"><code class="codeBlockLines_fQUY"><span class="token-line" style="color:#393A34"><span class="token function" style="color:#d73a49">it</span><span class="token punctuation" style="color:#393A34">(</span><span class="token string" style="color:#e3116c">'When the passed isStillness changes, clear the corresponding dom element or reload the original one'</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">async</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">(</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"> </span><span class="token arrow operator" style="color:#393A34">=&gt;</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token keyword" style="color:#00009f">const</span><span class="token plain"> </span><span class="token function-variable function maybe-class-name" style="color:#d73a49">Demo</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">(</span><span class="token parameter punctuation" style="color:#393A34">{</span><span class="token parameter"> isStillness </span><span class="token parameter punctuation" style="color:#393A34">}</span><span class="token parameter operator" style="color:#393A34">:</span><span class="token parameter"> any</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"> </span><span class="token arrow operator" style="color:#393A34">=&gt;</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token keyword control-flow" style="color:#00009f">return</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      </span><span class="token operator" style="color:#393A34">&lt;</span><span class="token maybe-class-name">OffscreenComponent</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        visible</span><span class="token operator" style="color:#393A34">=</span><span class="token punctuation" style="color:#393A34">{</span><span class="token boolean" style="color:#36acaa">true</span><span class="token punctuation" style="color:#393A34">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        isStillness</span><span class="token operator" style="color:#393A34">=</span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain">isStillness</span><span class="token punctuation" style="color:#393A34">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        uniqueId</span><span class="token operator" style="color:#393A34">=</span><span class="token string" style="color:#e3116c">"test1"</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        stillnessManager</span><span class="token operator" style="color:#393A34">=</span><span class="token punctuation" style="color:#393A34">{</span><span class="token function" style="color:#d73a49">mockStillnessManager</span><span class="token punctuation" style="color:#393A34">(</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        parentId</span><span class="token operator" style="color:#393A34">=</span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain">rootId</span><span class="token punctuation" style="color:#393A34">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        parentIsStillness</span><span class="token operator" style="color:#393A34">=</span><span class="token punctuation" style="color:#393A34">{</span><span class="token boolean" style="color:#36acaa">false</span><span class="token punctuation" style="color:#393A34">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      </span><span class="token operator" style="color:#393A34">&gt;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token operator" style="color:#393A34">&lt;</span><span class="token plain">div data</span><span class="token operator" style="color:#393A34">-</span><span class="token plain">testid</span><span class="token operator" style="color:#393A34">=</span><span class="token string" style="color:#e3116c">"content"</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">/</span><span class="token operator" style="color:#393A34">&gt;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      </span><span class="token operator" style="color:#393A34">&lt;</span><span class="token operator" style="color:#393A34">/</span><span class="token maybe-class-name">OffscreenComponent</span><span class="token operator" style="color:#393A34">&gt;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token punctuation" style="color:#393A34">}</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token keyword" style="color:#00009f">const</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"> queryByTestId</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> rerender </span><span class="token punctuation" style="color:#393A34">}</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> </span><span class="token function" style="color:#d73a49">render</span><span class="token punctuation" style="color:#393A34">(</span><span class="token operator" style="color:#393A34">&lt;</span><span class="token maybe-class-name">Demo</span><span class="token plain"> isStillness</span><span class="token operator" style="color:#393A34">=</span><span class="token punctuation" style="color:#393A34">{</span><span class="token boolean" style="color:#36acaa">false</span><span class="token punctuation" style="color:#393A34">}</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">/</span><span class="token operator" style="color:#393A34">&gt;</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token function" style="color:#d73a49">rerender</span><span class="token punctuation" style="color:#393A34">(</span><span class="token operator" style="color:#393A34">&lt;</span><span class="token maybe-class-name">Demo</span><span class="token plain"> isStillness</span><span class="token operator" style="color:#393A34">=</span><span class="token punctuation" style="color:#393A34">{</span><span class="token boolean" style="color:#36acaa">true</span><span class="token punctuation" style="color:#393A34">}</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">/</span><span class="token operator" style="color:#393A34">&gt;</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token function" style="color:#d73a49">expect</span><span class="token punctuation" style="color:#393A34">(</span><span class="token function" style="color:#d73a49">queryByTestId</span><span class="token punctuation" style="color:#393A34">(</span><span class="token string" style="color:#e3116c">'content'</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">.</span><span class="token property-access">not</span><span class="token punctuation" style="color:#393A34">.</span><span class="token method function property-access" style="color:#d73a49">toBeInTheDocument</span><span class="token punctuation" style="color:#393A34">(</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token function" style="color:#d73a49">rerender</span><span class="token punctuation" style="color:#393A34">(</span><span class="token operator" style="color:#393A34">&lt;</span><span class="token maybe-class-name">Demo</span><span class="token plain"> isStillness</span><span class="token operator" style="color:#393A34">=</span><span class="token punctuation" style="color:#393A34">{</span><span class="token boolean" style="color:#36acaa">false</span><span class="token punctuation" style="color:#393A34">}</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">/</span><span class="token operator" style="color:#393A34">&gt;</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token function" style="color:#d73a49">expect</span><span class="token punctuation" style="color:#393A34">(</span><span class="token function" style="color:#d73a49">queryByTestId</span><span class="token punctuation" style="color:#393A34">(</span><span class="token string" style="color:#e3116c">'content'</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">.</span><span class="token method function property-access" style="color:#d73a49">toBeInTheDocument</span><span class="token punctuation" style="color:#393A34">(</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token punctuation" style="color:#393A34">}</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">;</span><br></span></code></pre><button type="button" aria-label="Copy code to clipboard" title="Copy" class="copyButton_eDfN clean-btn"><span class="copyButtonIcons_W9eQ" aria-hidden="true"><svg class="copyButtonIcon_XEyF" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_i9w9" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div><p>ç»„ä»¶çš„<code>isStillness</code>å±æ€§æ˜¯æ¯”è¾ƒé‡è¦çš„,ä¹Ÿæ˜¯ç”¨æ¥æ§åˆ¶ç»„ä»¶çš„é™æ­¢ä¸å¦çš„æ¡ä»¶,åœ¨è¿™é‡Œé€šè¿‡çœŸå®æ¨¡æ‹Ÿ<code>render</code>,å¹¶é€šè¿‡ä¿®æ”¹ä¼ å‚çš„æ–¹æ³•,æ¥ç›´æ¥æ¨¡æ‹Ÿæ•ˆæœ,å¦‚æœä¼ é€’äº†<code>true</code>,åˆ™ç»„ä»¶åº”è¯¥ä¼šæ¸²æŸ“åœ¨ <code>body</code> ä¸­,ä¹Ÿå°±æ˜¯æŸ¥æ‰¾<code>id</code>ä¸º<code>content</code>çš„å…ƒç´ ä¸€å®šå¯ä»¥æ‰¾åˆ°,åä¹‹å°±æ‰¾ä¸åˆ°.</p><p>é€šè¿‡è¿™ç§æ–¹æ³•,å°±å¯ä»¥æµ‹è¯• <code>class Component</code></p><p>æ›´å¤šä¾‹å­è¯·å‚è€ƒ <a href="https://github.com/leomYili/react-stillness-component/blob/main/packages/react-stillness/src/components/__tests__/Offscreen.spec.tsx" target="_blank" rel="noopener noreferrer">Offscreen.spec.tsx</a></p><h3 class="anchor anchorWithHideOnScrollNavbar_R0VQ" id="hoc">HOC<a class="hash-link" href="#hoc" title="Direct link to heading">â€‹</a></h3><p><code>HOC</code>æ˜¯å¦‚ä½•è¿›è¡Œæµ‹è¯•çš„å‘¢,ä»¥<code>&lt;Offscreen&gt;</code>ç»„ä»¶ä¸ºä¾‹:</p><p>å…¶ <code>props</code> ä¸º:</p><ul><li>visible:boolean ç±»å‹,æ§åˆ¶ç»„ä»¶æ˜¯å¦é™æ­¢</li><li>type:string or number,æ ‡è¯†ç»„ä»¶çš„ç±»å‹,å¯é‡å¤,åŒä¸€ç±»å‹çš„é™æ­¢è¡Œä¸ºä¼šä¿æŒä¸€è‡´</li><li>scrollRest:boolean ç±»å‹,æ§åˆ¶ç»„ä»¶é™æ­¢æ—¶æ˜¯å¦ç¼“å­˜æ»šåŠ¨ä½ç½®</li></ul><p>ä½†è¿™äº›<code>props</code>å®é™…ä¸Šæ˜¯ç»è¿‡å¤„ç†ä¼ é€’ç»™<code>&lt;OffscreenComponent&gt;</code>ç»„ä»¶çš„,</p><p>å¯¹äº<code>HOC</code>è‡ªèº«æ¥è¯´,åªéœ€è¦ä¿è¯åœ¨æœªæ‰¾åˆ°<code>context</code>æ—¶è¿›è¡Œæ•è·å¼‚å¸¸å³å¯:</p><div class="codeBlockContainer_X7hc language-js theme-code-block"><div class="codeBlockContent_vqWU" style="color:#393A34;background-color:#f6f8fa"><pre tabindex="0" class="prism-code language-js codeBlock_wPnj thin-scrollbar"><code class="codeBlockLines_fQUY"><span class="token-line" style="color:#393A34"><span class="token function" style="color:#d73a49">it</span><span class="token punctuation" style="color:#393A34">(</span><span class="token string" style="color:#e3116c">'throw an error if rendered'</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">(</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"> </span><span class="token arrow operator" style="color:#393A34">=&gt;</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token console class-name">console</span><span class="token punctuation" style="color:#393A34">.</span><span class="token property-access">error</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> jest</span><span class="token punctuation" style="color:#393A34">.</span><span class="token method function property-access" style="color:#d73a49">fn</span><span class="token punctuation" style="color:#393A34">(</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token keyword" style="color:#00009f">class</span><span class="token plain"> </span><span class="token class-name">TestClass</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">extends</span><span class="token plain"> </span><span class="token class-name">React</span><span class="token class-name punctuation" style="color:#393A34">.</span><span class="token class-name">Component</span><span class="token operator" style="color:#393A34">&lt;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token maybe-class-name">React</span><span class="token punctuation" style="color:#393A34">.</span><span class="token property-access maybe-class-name">PropsWithChildren</span><span class="token operator" style="color:#393A34">&lt;</span><span class="token maybe-class-name">OffscreenInnerProps</span><span class="token operator" style="color:#393A34">&gt;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token operator" style="color:#393A34">&gt;</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token punctuation" style="color:#393A34">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token keyword" style="color:#00009f">const</span><span class="token plain"> </span><span class="token maybe-class-name">DecoratedClass</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> </span><span class="token function" style="color:#d73a49">withNodeBridge</span><span class="token punctuation" style="color:#393A34">(</span><span class="token maybe-class-name">TestClass</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token function" style="color:#d73a49">expect</span><span class="token punctuation" style="color:#393A34">(</span><span class="token punctuation" style="color:#393A34">(</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"> </span><span class="token arrow operator" style="color:#393A34">=&gt;</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token function" style="color:#d73a49">render</span><span class="token punctuation" style="color:#393A34">(</span><span class="token operator" style="color:#393A34">&lt;</span><span class="token maybe-class-name">DecoratedClass</span><span class="token plain"> visible </span><span class="token operator" style="color:#393A34">/</span><span class="token operator" style="color:#393A34">&gt;</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token punctuation" style="color:#393A34">}</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">.</span><span class="token method function property-access" style="color:#d73a49">toThrow</span><span class="token punctuation" style="color:#393A34">(</span><span class="token regex regex-delimiter" style="color:#36acaa">/</span><span class="token regex regex-source language-regex" style="color:#36acaa">Expected stillness component context</span><span class="token regex regex-delimiter" style="color:#36acaa">/</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token punctuation" style="color:#393A34">}</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">;</span><br></span></code></pre><button type="button" aria-label="Copy code to clipboard" title="Copy" class="copyButton_eDfN clean-btn"><span class="copyButtonIcons_W9eQ" aria-hidden="true"><svg class="copyButtonIcon_XEyF" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_i9w9" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div><p>è‡³äºä¸Šé¢çš„<code>props</code>,ç”±äºæ¶‰åŠåˆ°äº†å…¶ä»–æ¨¡å—,å±äº<code>BDD</code>æµ‹è¯•çš„èŒƒç•´äº†,ä¼šåœ¨ä¸‹ä¸€ç¯‡ BDD æµ‹è¯•ç›¸å…³è¿›è¡Œä»‹ç»</p><h3 class="anchor anchorWithHideOnScrollNavbar_R0VQ" id="hooks">hooks<a class="hash-link" href="#hooks" title="Direct link to heading">â€‹</a></h3><p>é’ˆå¯¹<code>hooks</code>ç›¸å…³,éœ€è¦ç”¨åˆ° <a href="https://github.com/testing-library/react-hooks-testing-library" target="_blank" rel="noopener noreferrer">@testing-library/react-hooks</a> è¯¥åº“å¯ä»¥ç›´æ¥è¿è¡Œ hooks å¹¶æ–­è¨€ç»“æœ</p><p>ä¸¾ä¾‹è¯´æ˜:</p><p>ç°åœ¨æœ‰ä¸€ä¸ªæ ¹æ®ä¾èµ–é¡¹ä»è€Œè¿”å›æœ€æ–°ç»“æœçš„ hooks <code>useOptionalFactory</code></p><p>ä»£ç ä¸º:</p><div class="codeBlockContainer_X7hc language-js theme-code-block"><div class="codeBlockContent_vqWU" style="color:#393A34;background-color:#f6f8fa"><pre tabindex="0" class="prism-code language-js codeBlock_wPnj thin-scrollbar"><code class="codeBlockLines_fQUY"><span class="token-line" style="color:#393A34"><span class="token keyword" style="color:#00009f">function</span><span class="token plain"> useOptionalFactory</span><span class="token operator" style="color:#393A34">&lt;</span><span class="token constant" style="color:#36acaa">T</span><span class="token operator" style="color:#393A34">&gt;</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token literal-property property" style="color:#36acaa">arg</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> </span><span class="token maybe-class-name">FactoryOrInstance</span><span class="token operator" style="color:#393A34">&lt;</span><span class="token constant" style="color:#36acaa">T</span><span class="token operator" style="color:#393A34">&gt;</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  deps</span><span class="token operator" style="color:#393A34">?</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> unknown</span><span class="token punctuation" style="color:#393A34">[</span><span class="token punctuation" style="color:#393A34">]</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token punctuation" style="color:#393A34">)</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> </span><span class="token constant" style="color:#36acaa">T</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token keyword" style="color:#00009f">const</span><span class="token plain"> memoDeps </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">[</span><span class="token spread operator" style="color:#393A34">...</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">deps </span><span class="token operator" style="color:#393A34">||</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">[</span><span class="token punctuation" style="color:#393A34">]</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">]</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token keyword control-flow" style="color:#00009f">if</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">deps </span><span class="token operator" style="color:#393A34">==</span><span class="token plain"> </span><span class="token keyword null nil" style="color:#00009f">null</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">&amp;&amp;</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">typeof</span><span class="token plain"> arg </span><span class="token operator" style="color:#393A34">!==</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">'function'</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    memoDeps</span><span class="token punctuation" style="color:#393A34">.</span><span class="token method function property-access" style="color:#d73a49">push</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">arg</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token punctuation" style="color:#393A34">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token keyword control-flow" style="color:#00009f">return</span><span class="token plain"> useMemo</span><span class="token operator" style="color:#393A34">&lt;</span><span class="token constant" style="color:#36acaa">T</span><span class="token operator" style="color:#393A34">&gt;</span><span class="token punctuation" style="color:#393A34">(</span><span class="token punctuation" style="color:#393A34">(</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"> </span><span class="token arrow operator" style="color:#393A34">=&gt;</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token keyword control-flow" style="color:#00009f">return</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">typeof</span><span class="token plain"> arg </span><span class="token operator" style="color:#393A34">===</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">'function'</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">?</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">arg </span><span class="token keyword module" style="color:#00009f">as</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">(</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"> </span><span class="token arrow operator" style="color:#393A34">=&gt;</span><span class="token plain"> </span><span class="token constant" style="color:#36acaa">T</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">(</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">arg </span><span class="token keyword module" style="color:#00009f">as</span><span class="token plain"> </span><span class="token constant" style="color:#36acaa">T</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token punctuation" style="color:#393A34">}</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> memoDeps</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token punctuation" style="color:#393A34">}</span><br></span></code></pre><button type="button" aria-label="Copy code to clipboard" title="Copy" class="copyButton_eDfN clean-btn"><span class="copyButtonIcons_W9eQ" aria-hidden="true"><svg class="copyButtonIcon_XEyF" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_i9w9" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div><p>æµ‹è¯•ç”¨ä¾‹çš„ä»£ç ä¸º:</p><div class="codeBlockContainer_X7hc language-js theme-code-block"><div class="codeBlockContent_vqWU" style="color:#393A34;background-color:#f6f8fa"><pre tabindex="0" class="prism-code language-js codeBlock_wPnj thin-scrollbar"><code class="codeBlockLines_fQUY"><span class="token-line" style="color:#393A34"><span class="token keyword module" style="color:#00009f">import</span><span class="token plain"> </span><span class="token imports punctuation" style="color:#393A34">{</span><span class="token imports"> renderHook</span><span class="token imports punctuation" style="color:#393A34">,</span><span class="token imports"> act </span><span class="token imports punctuation" style="color:#393A34">}</span><span class="token plain"> </span><span class="token keyword module" style="color:#00009f">from</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">'@testing-library/react-hooks'</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token keyword" style="color:#00009f">const</span><span class="token plain"> </span><span class="token function-variable function" style="color:#d73a49">useTest</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">(</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"> </span><span class="token arrow operator" style="color:#393A34">=&gt;</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token keyword" style="color:#00009f">const</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">[</span><span class="token plain">count</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> setCount</span><span class="token punctuation" style="color:#393A34">]</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> </span><span class="token maybe-class-name">React</span><span class="token punctuation" style="color:#393A34">.</span><span class="token method function property-access" style="color:#d73a49">useState</span><span class="token punctuation" style="color:#393A34">(</span><span class="token number" style="color:#36acaa">0</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token keyword" style="color:#00009f">const</span><span class="token plain"> </span><span class="token function-variable function" style="color:#d73a49">addCount</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">(</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"> </span><span class="token arrow operator" style="color:#393A34">=&gt;</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token function" style="color:#d73a49">setCount</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">count </span><span class="token operator" style="color:#393A34">+</span><span class="token plain"> </span><span class="token number" style="color:#36acaa">1</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token punctuation" style="color:#393A34">}</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token keyword" style="color:#00009f">const</span><span class="token plain"> optionFactoryFn </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> </span><span class="token function" style="color:#d73a49">useOptionalFactory</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token punctuation" style="color:#393A34">(</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"> </span><span class="token arrow operator" style="color:#393A34">=&gt;</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">(</span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      </span><span class="token function-variable function" style="color:#d73a49">collect</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">(</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"> </span><span class="token arrow operator" style="color:#393A34">=&gt;</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token keyword control-flow" style="color:#00009f">return</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token punctuation" style="color:#393A34">}</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      </span><span class="token punctuation" style="color:#393A34">}</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token punctuation" style="color:#393A34">}</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token punctuation" style="color:#393A34">[</span><span class="token plain">count</span><span class="token punctuation" style="color:#393A34">]</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token keyword control-flow" style="color:#00009f">return</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"> addCount</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> optionFactoryFn </span><span class="token punctuation" style="color:#393A34">}</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token punctuation" style="color:#393A34">}</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token function" style="color:#d73a49">describe</span><span class="token punctuation" style="color:#393A34">(</span><span class="token string" style="color:#e3116c">'useOptionalFactory'</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">(</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"> </span><span class="token arrow operator" style="color:#393A34">=&gt;</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token keyword" style="color:#00009f">let</span><span class="token plain"> hook</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token function" style="color:#d73a49">it</span><span class="token punctuation" style="color:#393A34">(</span><span class="token string" style="color:#e3116c">'Depending on the variation of the dependency value, different results are generated'</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">(</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"> </span><span class="token arrow operator" style="color:#393A34">=&gt;</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token function" style="color:#d73a49">act</span><span class="token punctuation" style="color:#393A34">(</span><span class="token punctuation" style="color:#393A34">(</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"> </span><span class="token arrow operator" style="color:#393A34">=&gt;</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      hook </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> </span><span class="token function" style="color:#d73a49">renderHook</span><span class="token punctuation" style="color:#393A34">(</span><span class="token punctuation" style="color:#393A34">(</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"> </span><span class="token arrow operator" style="color:#393A34">=&gt;</span><span class="token plain"> </span><span class="token function" style="color:#d73a49">useTest</span><span class="token punctuation" style="color:#393A34">(</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token punctuation" style="color:#393A34">}</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token keyword" style="color:#00009f">let</span><span class="token plain"> memoValue </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> hook</span><span class="token punctuation" style="color:#393A34">.</span><span class="token property-access">result</span><span class="token punctuation" style="color:#393A34">.</span><span class="token property-access">current</span><span class="token punctuation" style="color:#393A34">.</span><span class="token property-access">optionFactoryFn</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token function" style="color:#d73a49">act</span><span class="token punctuation" style="color:#393A34">(</span><span class="token punctuation" style="color:#393A34">(</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"> </span><span class="token arrow operator" style="color:#393A34">=&gt;</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      hook</span><span class="token punctuation" style="color:#393A34">.</span><span class="token property-access">result</span><span class="token punctuation" style="color:#393A34">.</span><span class="token property-access">current</span><span class="token punctuation" style="color:#393A34">.</span><span class="token method function property-access" style="color:#d73a49">addCount</span><span class="token punctuation" style="color:#393A34">(</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token punctuation" style="color:#393A34">}</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token function" style="color:#d73a49">expect</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">memoValue</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">.</span><span class="token property-access">not</span><span class="token punctuation" style="color:#393A34">.</span><span class="token method function property-access" style="color:#d73a49">toStrictEqual</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">hook</span><span class="token punctuation" style="color:#393A34">.</span><span class="token property-access">result</span><span class="token punctuation" style="color:#393A34">.</span><span class="token property-access">current</span><span class="token punctuation" style="color:#393A34">.</span><span class="token property-access">optionFactoryFn</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token punctuation" style="color:#393A34">}</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token punctuation" style="color:#393A34">}</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">;</span><br></span></code></pre><button type="button" aria-label="Copy code to clipboard" title="Copy" class="copyButton_eDfN clean-btn"><span class="copyButtonIcons_W9eQ" aria-hidden="true"><svg class="copyButtonIcon_XEyF" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_i9w9" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div><p>é€šè¿‡ä½¿ç”¨ <code>renderHooks()</code> ä¸ <code>act()</code>,å³å¯ç®€å•è¿›è¡Œæµ‹è¯•,å½“æµ‹è¯•çš„ä¾èµ–é¡¹å˜åŒ–æ—¶,è¿”å›å€¼åˆ™è·Ÿéšè¿›è¡Œå˜åŒ–.</p><h2 class="anchor anchorWithHideOnScrollNavbar_R0VQ" id="å››é—®é¢˜æ±‡æ€»">å››.é—®é¢˜æ±‡æ€»<a class="hash-link" href="#å››é—®é¢˜æ±‡æ€»" title="Direct link to heading">â€‹</a></h2><ol><li><p>å¦‚ä½•æ­å»ºæµ‹è¯•ç¯å¢ƒ?</p><p>æ•´ä½“æ¶æ„ä¸º<code>lerna+Typescript+React+rollup+Jest</code>,å…¶å®ç¤¾åŒºä¹Ÿæœ‰äº†å¾ˆå¤šçš„å®ä¾‹äº†,è¿™é‡Œåªä»‹ç»æ­å»ºè¿‡ç¨‹ä¸­é‡åˆ°çš„é—®é¢˜,</p><ul><li><p>å¦‚ä½•å•ç‹¬æ­å»ºå­åŒ…çš„æµ‹è¯•ç¯å¢ƒ?
lerna çš„æ¶æ„,å¾ˆå¥½çš„åˆ†ç¦»äº†æ¯ä¸ªåŒ…çš„ç¯å¢ƒ,å¯ä»¥ä½¿ç”¨ä¸åŒçš„æµ‹è¯•æ¡†æ¶åœ¨æ¯ä¸ªå­åŒ…ä¸­,å•ç‹¬é…ç½®,ä¸¾ä¾‹:
<img loading="lazy" alt="13" src="/react-stillness-component/zh-CN/assets/images/13-bc684bb75fe9bfc7cad728d436e283d0.png" width="702" height="666" class="img_E7b_">
å¯ä»¥åœ¨æ¯ä¸ªåŒ…ä¸­é…ç½®ä¸åŒçš„ <strong>jest.config</strong></p></li><li><p>æµ‹è¯•ä»£ç ä¹Ÿå¸Œæœ›ä½¿ç”¨<code>Typescript</code>?</p><div class="codeBlockContainer_X7hc language-js theme-code-block"><div class="codeBlockContent_vqWU" style="color:#393A34;background-color:#f6f8fa"><pre tabindex="0" class="prism-code language-js codeBlock_wPnj thin-scrollbar"><code class="codeBlockLines_fQUY"><span class="token-line" style="color:#393A34"><span class="token comment" style="color:#999988;font-style:italic">// jest-transformer.js</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token keyword" style="color:#00009f">const</span><span class="token plain"> babelJest </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> </span><span class="token function" style="color:#d73a49">require</span><span class="token punctuation" style="color:#393A34">(</span><span class="token string" style="color:#e3116c">'babel-jest'</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">module</span><span class="token punctuation" style="color:#393A34">.</span><span class="token property-access">exports</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> babelJest</span><span class="token punctuation" style="color:#393A34">.</span><span class="token method function property-access" style="color:#d73a49">createTransformer</span><span class="token punctuation" style="color:#393A34">(</span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token literal-property property" style="color:#36acaa">presets</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">[</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token punctuation" style="color:#393A34">[</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      </span><span class="token string" style="color:#e3116c">'@babel/preset-env'</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token literal-property property" style="color:#36acaa">targets</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">          </span><span class="token literal-property property" style="color:#36acaa">node</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">'current'</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">          </span><span class="token literal-property property" style="color:#36acaa">esmodules</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> </span><span class="token boolean" style="color:#36acaa">true</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token punctuation" style="color:#393A34">}</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token literal-property property" style="color:#36acaa">bugfixes</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> </span><span class="token boolean" style="color:#36acaa">true</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token literal-property property" style="color:#36acaa">loose</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> </span><span class="token boolean" style="color:#36acaa">true</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      </span><span class="token punctuation" style="color:#393A34">}</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token punctuation" style="color:#393A34">]</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token string" style="color:#e3116c">'@babel/preset-typescript'</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token punctuation" style="color:#393A34">]</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token literal-property property" style="color:#36acaa">plugins</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">[</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token punctuation" style="color:#393A34">[</span><span class="token string" style="color:#e3116c">'@babel/plugin-proposal-class-properties'</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"> </span><span class="token literal-property property" style="color:#36acaa">loose</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> </span><span class="token boolean" style="color:#36acaa">true</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">}</span><span class="token punctuation" style="color:#393A34">]</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token string" style="color:#e3116c">'@babel/plugin-transform-react-jsx'</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token punctuation" style="color:#393A34">[</span><span class="token string" style="color:#e3116c">'@babel/plugin-proposal-private-methods'</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"> </span><span class="token literal-property property" style="color:#36acaa">loose</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> </span><span class="token boolean" style="color:#36acaa">true</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">}</span><span class="token punctuation" style="color:#393A34">]</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token punctuation" style="color:#393A34">[</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      </span><span class="token string" style="color:#e3116c">'@babel/plugin-proposal-private-property-in-object'</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"> </span><span class="token literal-property property" style="color:#36acaa">loose</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> </span><span class="token boolean" style="color:#36acaa">true</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">}</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token punctuation" style="color:#393A34">]</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token string" style="color:#e3116c">'@babel/plugin-proposal-object-rest-spread'</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token string" style="color:#e3116c">'@babel/plugin-transform-runtime'</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token punctuation" style="color:#393A34">]</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token punctuation" style="color:#393A34">}</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token comment" style="color:#999988;font-style:italic">//jest.config.js</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">module</span><span class="token punctuation" style="color:#393A34">.</span><span class="token property-access">exports</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token literal-property property" style="color:#36acaa">setupFilesAfterEnv</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">[</span><span class="token string" style="color:#e3116c">'./jest-setup.ts'</span><span class="token punctuation" style="color:#393A34">]</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token literal-property property" style="color:#36acaa">testMatch</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">[</span><span class="token string" style="color:#e3116c">"**/__tests__/**/?(*.)(spec|test).[jt]s?(x)"</span><span class="token punctuation" style="color:#393A34">]</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token comment" style="color:#999988;font-style:italic">// testRegex: 'decorateHandler.spec.tsx',</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token literal-property property" style="color:#36acaa">transform</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token string-property property" style="color:#36acaa">"\\.[jt]sx?$"</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">"./jest-transformer.js"</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token punctuation" style="color:#393A34">}</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token literal-property property" style="color:#36acaa">collectCoverageFrom</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">[</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token string" style="color:#e3116c">'**/src/**/*.tsx'</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token string" style="color:#e3116c">'**/src/**/*.ts'</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token string" style="color:#e3116c">'!**/__tests__/**'</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token string" style="color:#e3116c">'!**/dist/**'</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token punctuation" style="color:#393A34">]</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token literal-property property" style="color:#36acaa">globals</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token literal-property property" style="color:#36acaa">__DEV__</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> </span><span class="token boolean" style="color:#36acaa">true</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token punctuation" style="color:#393A34">}</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token punctuation" style="color:#393A34">}</span><span class="token punctuation" style="color:#393A34">;</span><br></span></code></pre><button type="button" aria-label="Copy code to clipboard" title="Copy" class="copyButton_eDfN clean-btn"><span class="copyButtonIcons_W9eQ" aria-hidden="true"><svg class="copyButtonIcon_XEyF" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_i9w9" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div><p>åªéœ€è¦å¢åŠ transformé…ç½®å³å¯</p></li></ul></li><li><p>å¦‚ä½•æµ‹è¯•å®é™…çš„æ¸²æŸ“æ•ˆæœ?</p><p>å¯ä½¿ç”¨ <a href="https://github.com/testing-library/jest-dom" target="_blank" rel="noopener noreferrer"><code>@testing-library/jest-dom</code></a>,è¯¥åº“æä¾›äº†å…³äº <code>DOM</code> çŠ¶æ€çš„ç›¸å…³ <code>jest</code> åŒ¹é…å™¨,å¯ç”¨æ¥æ£€æŸ¥å…ƒç´ çš„æ ‘å½¢,æ–‡æœ¬,æ ·å¼ç­‰,æœ¬æ–‡ä¹Ÿä»‹ç»äº†ä¸€äº›,æ¯”å¦‚:</p><ul><li>toBeInTheDocument:åˆ¤æ–­æ–‡æ¡£ä¸­æ˜¯å¦å­˜åœ¨å…ƒç´ </li><li>toHaveClass:åˆ¤æ–­ç»™å®šå…ƒç´ ä¸­æ˜¯å¦åœ¨å…¶classå±æ€§ä¸­å…·æœ‰ç›¸åº”çš„ç±»å</li><li>toBeVisible:åˆ¤æ–­ç»™å®šå…ƒç´ æ˜¯å¦å¯¹ç”¨æˆ·å¯è§</li></ul></li><li><p>æƒ³è¦å•ç‹¬æµ‹è¯•æŸä¸€ä¸ªä¾‹å­æ€ä¹ˆåŠ?</p><div class="codeBlockContainer_X7hc language-js theme-code-block"><div class="codeBlockContent_vqWU" style="color:#393A34;background-color:#f6f8fa"><pre tabindex="0" class="prism-code language-js codeBlock_wPnj thin-scrollbar"><code class="codeBlockLines_fQUY"><span class="token-line" style="color:#393A34"><span class="token comment" style="color:#999988;font-style:italic">//jest.config.js</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">module</span><span class="token punctuation" style="color:#393A34">.</span><span class="token property-access">exports</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token literal-property property" style="color:#36acaa">setupFilesAfterEnv</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">[</span><span class="token string" style="color:#e3116c">'./jest-setup.ts'</span><span class="token punctuation" style="color:#393A34">]</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token comment" style="color:#999988;font-style:italic">//testMatch: ["**/__tests__/**/?(*.)(spec|test).[jt]s?(x)"],</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token literal-property property" style="color:#36acaa">testRegex</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">'decorateHandler.spec.tsx'</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token literal-property property" style="color:#36acaa">transform</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token string-property property" style="color:#36acaa">"\\.[jt]sx?$"</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">"./jest-transformer.js"</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token punctuation" style="color:#393A34">}</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token literal-property property" style="color:#36acaa">collectCoverageFrom</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">[</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token string" style="color:#e3116c">'**/src/**/*.tsx'</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token string" style="color:#e3116c">'**/src/**/*.ts'</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token string" style="color:#e3116c">'!**/__tests__/**'</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token string" style="color:#e3116c">'!**/dist/**'</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token punctuation" style="color:#393A34">]</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token literal-property property" style="color:#36acaa">globals</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token literal-property property" style="color:#36acaa">__DEV__</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> </span><span class="token boolean" style="color:#36acaa">true</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token punctuation" style="color:#393A34">}</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token punctuation" style="color:#393A34">}</span><span class="token punctuation" style="color:#393A34">;</span><br></span></code></pre><button type="button" aria-label="Copy code to clipboard" title="Copy" class="copyButton_eDfN clean-btn"><span class="copyButtonIcons_W9eQ" aria-hidden="true"><svg class="copyButtonIcon_XEyF" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_i9w9" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div><p>å¯ä»¥ç®€å•çš„ä¿®æ”¹é…ç½®æ–‡ä»¶,ä½¿ç”¨<code>testRegex</code>é’ˆå¯¹æŸä¸€ä¸ªæ–‡ä»¶è¿›è¡Œæµ‹è¯•,å½“ç„¶,è¿™é‡Œä½œè€…åªæ˜¯åˆ—å‡ºäº†è‡ªèº«è®¤ä¸ºæ¯”è¾ƒç®€å•çš„æ–¹æ³•,å¦‚æœæœ‰æ›´ç®€å•çš„æ–¹æ³•,æ¬¢è¿æå‡ºğŸ‘ğŸ‘</p></li></ol><h2 class="anchor anchorWithHideOnScrollNavbar_R0VQ" id="äº”æ€»ç»“">äº”.æ€»ç»“<a class="hash-link" href="#äº”æ€»ç»“" title="Direct link to heading">â€‹</a></h2><p>æœ¬æ–‡æ€»ç»“äº†åœ¨ç¼–å†™ä¸€ä¸ª <code>react</code> ç»„ä»¶çš„è¿‡ç¨‹ä¸­æ˜¯å¦‚ä½•æ€è€ƒä»¥åŠç»„ç»‡æµ‹è¯•ä»£ç çš„,å½“ç„¶,åœ¨å®é™…çš„ç”Ÿäº§å¼€å‘é˜¶æ®µ,æœ‰ä¸€å®šçš„æµ‹è¯•æ—¶é—´æ‰æ˜¯æœ€å®è´µçš„,ä¹Ÿæ˜¯ <code>TDD</code> æµ‹è¯•èƒ½æ¨è¡Œçš„åŸºç¡€,å¦‚æœè¯´ <code>TDD</code> æµ‹è¯•ä¿è¯äº†åŸºç¡€åŠŸèƒ½,é‚£ä¹ˆ <code>BDD</code> æµ‹è¯•åˆ™æ‰©å±•äº†ä½¿ç”¨åœºæ™¯;</p><p>æŒ‰ç…§ä»£ç æ¯”ä¾‹æ¥è¯´,ä½œè€…è‡ªèº«è®¤ä¸º <code>TDD</code> å  70%,è€Œ <code>BDD</code> åˆ™å åˆ°å‰©ä¸‹çš„ 30%;</p><p>è¿™é‡Œé¢æ˜¯æ€§ä»·æ¯”çš„è€ƒé‡,æ¯•ç«Ÿæ—¥å¸¸å·¥ä½œä¸­,éœ€æ±‚çš„æ”¹åŠ¨æ˜¯å¾ˆé¢‘ç¹çš„,è¿™ä¹Ÿå°±æ„å‘³ç€ç»„ä»¶å¯èƒ½ä¼šé‡åˆ°å„ç§ä¸åŒçš„åœºæ™¯,è€Œ <code>TDD</code> æµ‹è¯•ç”¨ä¾‹å¤§éƒ¨åˆ†ä»ç„¶å¯ä»¥ä¿ç•™,ä½† <code>BDD</code> æµ‹è¯•å°±ä¸ä¸€å®šäº†.</p><p>è¿™æ˜¯ ã€Šå‰ç«¯å¦‚ä½•åšç»„ä»¶æµ‹è¯•ã€‹çš„ç¬¬ä¸€ç¯‡,å¦‚æœæœ‰ä»»ä½•é—®é¢˜,æ¬¢è¿è®¨è®º.</p>]]></content>
        <author>
            <name>leomYili</name>
            <uri>https://github.com/leomYili</uri>
        </author>
        <category label="TDD" term="TDD"/>
        <category label="test" term="test"/>
    </entry>
    <entry>
        <title type="html"><![CDATA[reactä¸­å¦‚ä½•å®ç°keep-alive]]></title>
        <id>Realization react-stillness-component</id>
        <link href="https://leomyili.github.io/react-stillness-component/zh-CN/blog/Realization react-stillness-component"/>
        <updated>2022-08-13T17:00:00.000Z</updated>
        <summary type="html"><![CDATA[è¿™æ˜¯æˆ‘å…³äºå‰ç«¯è‡ªåŠ¨åŒ–æµ‹è¯•çš„ç¬¬ä¸€ç¯‡åšæ–‡ã€‚]]></summary>
        <content type="html"><![CDATA[<blockquote><p>é¡¹ç›®ç›¸å…³åœ°å€: <a href="https://leomyili.github.io/react-stillness-component/" target="_blank" rel="noopener noreferrer">react-stillness-component</a>,ç›®å‰æµ‹è¯•ç‡å·²è¾¾åˆ° 90%,æ¬¢è¿å¤§å®¶è¯•ç”¨</p><p>å®˜æ–¹å†å²ç›¸å…³è®¨è®º: <a href="https://github.com/facebook/react/issues/12039" target="_blank" rel="noopener noreferrer">åœ°å€</a></p><p>æœ€æ–° react18 å®˜æ–¹æ–¹æ¡ˆè®¨è®º: <a href="https://github.com/reactwg/react-18/discussions/19" target="_blank" rel="noopener noreferrer">åœ°å€</a></p></blockquote><p>æœ¬æ–‡è¯¦ç»†æè¿°äº†å¦‚ä½•æ„æ€å¹¶å®ç°ä¸€ä¸ªå…·æœ‰å…¨å±€çŠ¶æ€ç¼“å­˜çš„ç»„ä»¶ <code>react-stillness-component</code>.</p><h2 class="anchor anchorWithHideOnScrollNavbar_R0VQ" id="ä¸€å‰è¨€-ç°æœ‰ç±»ä¼¼ç»„ä»¶åˆ†æ">ä¸€.å‰è¨€-ç°æœ‰ç±»ä¼¼ç»„ä»¶åˆ†æ<a class="hash-link" href="#ä¸€å‰è¨€-ç°æœ‰ç±»ä¼¼ç»„ä»¶åˆ†æ" title="Direct link to heading">â€‹</a></h2><p>ä½œè€…æ­£å¸¸éœ€è¦é¢å¤–ç¼–å†™é€šç”¨ç»„ä»¶çš„åœºæ™¯éƒ½æ˜¯é‡åˆ°äº†ç‰¹æ®Šçš„é—®é¢˜, ä¸”ç°æœ‰ç»„ä»¶æ— æ³•å®ç°æˆ–è€…æˆæœ¬ä¼šéå¸¸é«˜çš„æƒ…å†µä¸‹æ‰ä¼šè€ƒè™‘å»é‡æ–°å¼€å‘æ–°çš„ç»„ä»¶.</p><p>è€Œé¢å¯¹ç»„ä»¶ç¼“å­˜çš„è¿™ä¸ªåœºæ™¯æ¥è¯´,ç¤¾åŒºç›®å‰å¥½çš„é€‰æ‹©åº”è¯¥ä¼šæ˜¯ <a href="https://github.com/CJY0208/react-activation/blob/master/README_CN.md" target="_blank" rel="noopener noreferrer">React Activation</a>, ,å°†ç»„ä»¶å®é™…æ¸²æŸ“åœ¨å¤–éƒ¨éšè—ç»„ä»¶å±‚çº§ä¸­,åœ¨ç»„ä»¶çœŸå®æ¸²æŸ“æ—¶å†é€šè¿‡ <code>DOM</code> çš„æ“ä½œå°†å…¶ç§»å…¥å¯¹åº”ç»„ä»¶çš„å¯¹åº”å®¹å™¨ä¸­,è¿™æ ·å°±å¯ä»¥å¦‚ä¸‹çš„è¯­æ³•æ¥æ§åˆ¶ç»„ä»¶çš„ç¼“å­˜:</p><div class="codeBlockContainer_X7hc language-jsx theme-code-block"><div class="codeBlockContent_vqWU" style="color:#393A34;background-color:#f6f8fa"><pre tabindex="0" class="prism-code language-jsx codeBlock_wPnj thin-scrollbar"><code class="codeBlockLines_fQUY"><span class="token-line" style="color:#393A34"><span class="token keyword" style="color:#00009f">import</span><span class="token plain"> KeepAlive </span><span class="token keyword" style="color:#00009f">from</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">'react-activation'</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token comment" style="color:#999988;font-style:italic">// keepAliveä¸­çš„ç»„ä»¶å®é™…ä¸Šæ˜¯æå‰æ¸²æŸ“åˆ°äº†å¤–éƒ¨çš„Keeperä¸­</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token comment" style="color:#999988;font-style:italic">// ä¹‹ååœ¨keepAliveå¼€å§‹æ¸²æŸ“æ—¶,å†é€šè¿‡Keeperä¸­å­˜å‚¨çš„æ•°æ®,å°†å¯¹åº”çš„domèŠ‚ç‚¹ç§»åŠ¨åˆ°è¿™é‡Œå³å¯</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token operator" style="color:#393A34">...</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token keyword" style="color:#00009f">function</span><span class="token plain"> </span><span class="token function" style="color:#d73a49">App</span><span class="token punctuation" style="color:#393A34">(</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token keyword" style="color:#00009f">const</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">[</span><span class="token plain">show</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> setShow</span><span class="token punctuation" style="color:#393A34">]</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> </span><span class="token function" style="color:#d73a49">useState</span><span class="token punctuation" style="color:#393A34">(</span><span class="token boolean" style="color:#36acaa">true</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token keyword" style="color:#00009f">return</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token tag punctuation" style="color:#393A34">&lt;</span><span class="token tag" style="color:#00009f">div</span><span class="token tag punctuation" style="color:#393A34">&gt;</span><span class="token plain-text"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain-text">      </span><span class="token tag punctuation" style="color:#393A34">&lt;</span><span class="token tag" style="color:#00009f">button</span><span class="token tag" style="color:#00009f"> </span><span class="token tag attr-name" style="color:#00a4db">onClick</span><span class="token tag script language-javascript script-punctuation punctuation" style="color:#393A34">=</span><span class="token tag script language-javascript punctuation" style="color:#393A34">{</span><span class="token tag script language-javascript punctuation" style="color:#393A34">(</span><span class="token tag script language-javascript punctuation" style="color:#393A34">)</span><span class="token tag script language-javascript" style="color:#00009f"> </span><span class="token tag script language-javascript operator" style="color:#393A34">=&gt;</span><span class="token tag script language-javascript" style="color:#00009f"> </span><span class="token tag script language-javascript function" style="color:#d73a49">setShow</span><span class="token tag script language-javascript punctuation" style="color:#393A34">(</span><span class="token tag script language-javascript parameter" style="color:#00009f">show</span><span class="token tag script language-javascript" style="color:#00009f"> </span><span class="token tag script language-javascript operator" style="color:#393A34">=&gt;</span><span class="token tag script language-javascript" style="color:#00009f"> </span><span class="token tag script language-javascript operator" style="color:#393A34">!</span><span class="token tag script language-javascript" style="color:#00009f">show</span><span class="token tag script language-javascript punctuation" style="color:#393A34">)</span><span class="token tag script language-javascript punctuation" style="color:#393A34">}</span><span class="token tag punctuation" style="color:#393A34">&gt;</span><span class="token plain-text">Toggle</span><span class="token tag punctuation" style="color:#393A34">&lt;/</span><span class="token tag" style="color:#00009f">button</span><span class="token tag punctuation" style="color:#393A34">&gt;</span><span class="token plain-text"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain-text">      </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain">show </span><span class="token operator" style="color:#393A34">&amp;&amp;</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token tag punctuation" style="color:#393A34">&lt;</span><span class="token tag class-name" style="color:#00009f">KeepAlive</span><span class="token tag punctuation" style="color:#393A34">&gt;</span><span class="token plain-text"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain-text">          </span><span class="token tag punctuation" style="color:#393A34">&lt;</span><span class="token tag class-name" style="color:#00009f">Counter</span><span class="token tag" style="color:#00009f"> </span><span class="token tag punctuation" style="color:#393A34">/&gt;</span><span class="token plain-text"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain-text">        </span><span class="token tag punctuation" style="color:#393A34">&lt;/</span><span class="token tag class-name" style="color:#00009f">KeepAlive</span><span class="token tag punctuation" style="color:#393A34">&gt;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      </span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">}</span><span class="token plain-text"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain-text">    </span><span class="token tag punctuation" style="color:#393A34">&lt;/</span><span class="token tag" style="color:#00009f">div</span><span class="token tag punctuation" style="color:#393A34">&gt;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token punctuation" style="color:#393A34">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token operator" style="color:#393A34">...</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span></code></pre><button type="button" aria-label="Copy code to clipboard" title="Copy" class="copyButton_eDfN clean-btn"><span class="copyButtonIcons_W9eQ" aria-hidden="true"><svg class="copyButtonIcon_XEyF" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_i9w9" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div><p>åœ¨ react18 ä¹‹å‰å·²ç»ç®—æ˜¯æ¯”è¾ƒä¸é”™çš„æ–¹æ³•äº†, ä¸è¿‡å¯¹äºæˆ‘ä»¬çš„åœºæ™¯æ¥è¯´è¿˜æ˜¯ä¼šæœ‰å‡ ä¸ªé—®é¢˜:</p><ol><li>è€é¡¹ç›®ä»£ç ååˆ†åºå¤§,ä¸Šè¿°çš„å®ç°æ–¹æ³•ä¼šå¸¦æ¥å¯¹ä¾èµ–ç”Ÿå‘½å‘¨æœŸé¡ºåºçš„åŠŸèƒ½é€ æˆå½±å“,æ¯”å¦‚ ref çš„å–å€¼ç­‰,è™½ç„¶å¯ä»¥é€šè¿‡ setTimeout çš„æ–¹å¼æ¥å»¶æ—¶è·å–,ä½†ä¸€ä¸ªæ˜¯æˆæœ¬ç•¥å¤§,å¦ä¸€ä¸ªéœ€è¦æ”¹å˜ä¹‹å‰çš„å†™æ³•,é¡¹ç›®ä¸­éšå¤„å¯è§çš„ setTimeout ä¹Ÿä¼šå½±å“ä»£ç çš„é˜…è¯»ä»¥åŠä»£ç  review</li><li>context å®é™…ä¸Šä¹Ÿæ˜¯å¦‚æ­¤,ä½†ç›¸æ¯”ä¸Šé¢çš„æƒ…å†µè¦å¥½å¾ˆå¤š,åªéœ€è¦åˆ‡æ¢æˆ <code>react-activation</code>æä¾›çš„ createContext å³å¯</li><li>åˆæˆäº‹ä»¶å†’æ³¡ä¼šå¤±æ•ˆ,è¿™ä¹Ÿæ˜¯æœ€ç»ˆæœªé‡‡ç”¨ä¸Šè¿°æ–¹æ¡ˆçš„æ ¹æœ¬åŸå› ,ä½œè€…æ‰€åœ¨çš„å›¢é˜Ÿä¼šæœ‰å¤šç»´è¡¨ç­‰å¤æ‚ç»„ä»¶,é’ˆå¯¹æ‹–æ‹½æ‚¬æµ®å®šä½éƒ½ä¼šæœ‰ä¸€å®šçš„è¦æ±‚,ç¼“å­˜ç›¸æ¯”åªèƒ½ç®—æ˜¯ä½“éªŒä¼˜åŒ–,ä¸èƒ½å½±å“ä¸»è¦åŠŸèƒ½.</li><li>åœ¨æ‰‹åŠ¨ç¼“å­˜æ—¶éœ€è¦ç»™æ¯ä¸ª<code>&lt;KeepAlive&gt;</code>ç»„ä»¶å¢åŠ <code>name</code>,ä¹Ÿä¼šå¢åŠ ä¸€å®šçš„æˆæœ¬.</li></ol><p>è€Œå¦‚æœæ˜¯é’ˆå¯¹æ–°é¡¹ç›®æ¥è¯´,è¿™ä¸ªåº“å®é™…ä¸Šå·²ç»å¯ä»¥è¾¾åˆ°ç”Ÿäº§ç¯å¢ƒçš„çº§åˆ«äº†.</p><h2 class="anchor anchorWithHideOnScrollNavbar_R0VQ" id="äºŒç†æƒ³æ•ˆæœ">äºŒ.ç†æƒ³æ•ˆæœ<a class="hash-link" href="#äºŒç†æƒ³æ•ˆæœ" title="Direct link to heading">â€‹</a></h2><p>è¿™é‡Œçš„ç†æƒ³æ•ˆæœæ˜¯ä½œè€…æœ€ç»ˆæƒ³è¦è¾¾åˆ°çš„ç›®æ ‡.</p><ol><li>é¦–å…ˆ,<code>keepalive</code>çš„æ•ˆæœåªèƒ½ç®—æ˜¯é”¦ä¸Šæ·»èŠ±,å®ƒä¸èƒ½å½±å“é¡¹ç›®ä¸­å…¶ä»–åŠŸèƒ½çš„å¼€å‘,æ‰€ä»¥ç±»ä¼¼ context,äº‹ä»¶å†’æ³¡,åŠ¨ç”»ä¹‹ç±»éƒ½ä¸èƒ½å—åˆ°å½±å“.</li><li>åŒæ—¶,ä¸Šæ‰‹æˆæœ¬ä¸èƒ½å¤ªé«˜,api è¦è¶³å¤Ÿç®€å•,ç±»ä¼¼æ‰‹åŠ¨å¢åŠ å”¯ä¸€æ ‡è¯†å¹¶è¿›è¡Œç®¡ç†çš„æ–¹å¼æˆæœ¬å°±æœ‰ç‚¹é«˜äº†,æœ€å¥½å¯ä»¥ä¸ç”¨å£°æ˜å”¯ä¸€æ ‡è¯†,ä½†ä¹Ÿèƒ½è¿›è¡Œæ‰‹åŠ¨å¸è½½.</li><li>æ€§èƒ½ä¼˜å…ˆ,æ‡’åŠ è½½,çœŸå®ç§»é™¤ DOM èŠ‚ç‚¹.</li><li>éœ€è¦è®°å¿†ç»„ä»¶çº§åˆ«çš„æ»šåŠ¨æ•ˆæœ.</li><li>è§£å†³åµŒå¥—ç»„ä»¶ä¸­çš„ç¼“å­˜æ•ˆæœä¸ä¸€è‡´,å¦‚æœä»…ä»…ä½¿ç”¨ä¸€ä¸ª state å»æ§åˆ¶æ˜¯å¦ç¼“å­˜,åˆ™åµŒå¥—ä¸­çš„<code>keep-alive</code>ç»„ä»¶å°±æ²¡åŠæ³•å®æ—¶æ›´æ–°äº†.</li><li>ç»Ÿä¸€çš„æ•°æ®é€šä¿¡æœºåˆ¶ä»¥åŠå±€éƒ¨æ›´æ–°</li></ol><p>ä¹Ÿå› æ­¤,é’ˆå¯¹ä¸Šè¿°ç›®æ ‡,ä½œè€…æœ€ç»ˆé€‰ç”¨äº† <a href="https://zh-hans.reactjs.org/docs/portals.html" target="_blank" rel="noopener noreferrer"><code>Portals</code></a>ä»¥åŠ redux(ç”¨æ¥ç®¡ç†ç¼“å­˜çŠ¶æ€)æ¥è§£å†³è¿™äº›é—®é¢˜</p><h2 class="anchor anchorWithHideOnScrollNavbar_R0VQ" id="ä¸‰å®ç°åŸç†">ä¸‰.å®ç°åŸç†<a class="hash-link" href="#ä¸‰å®ç°åŸç†" title="Direct link to heading">â€‹</a></h2><p>å…ˆæ¥çœ‹ä¸€æ®µä¼ªä»£ç </p><div class="codeBlockContainer_X7hc language-jsx theme-code-block"><div class="codeBlockContent_vqWU" style="color:#393A34;background-color:#f6f8fa"><pre tabindex="0" class="prism-code language-jsx codeBlock_wPnj thin-scrollbar"><code class="codeBlockLines_fQUY"><span class="token-line" style="color:#393A34"><span class="token keyword" style="color:#00009f">import</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"> Offscreen</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain">useStillness </span><span class="token punctuation" style="color:#393A34">}</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">from</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">'react-stillness-component'</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token operator" style="color:#393A34">...</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token keyword" style="color:#00009f">function</span><span class="token plain"> </span><span class="token function" style="color:#d73a49">App</span><span class="token punctuation" style="color:#393A34">(</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token keyword" style="color:#00009f">const</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">[</span><span class="token plain">show</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> setShow</span><span class="token punctuation" style="color:#393A34">]</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> </span><span class="token function" style="color:#d73a49">useState</span><span class="token punctuation" style="color:#393A34">(</span><span class="token boolean" style="color:#36acaa">true</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token keyword" style="color:#00009f">return</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token tag punctuation" style="color:#393A34">&lt;</span><span class="token tag" style="color:#00009f">div</span><span class="token tag punctuation" style="color:#393A34">&gt;</span><span class="token plain-text"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain-text">      </span><span class="token tag punctuation" style="color:#393A34">&lt;</span><span class="token tag" style="color:#00009f">button</span><span class="token tag" style="color:#00009f"> </span><span class="token tag attr-name" style="color:#00a4db">onClick</span><span class="token tag script language-javascript script-punctuation punctuation" style="color:#393A34">=</span><span class="token tag script language-javascript punctuation" style="color:#393A34">{</span><span class="token tag script language-javascript punctuation" style="color:#393A34">(</span><span class="token tag script language-javascript punctuation" style="color:#393A34">)</span><span class="token tag script language-javascript" style="color:#00009f"> </span><span class="token tag script language-javascript operator" style="color:#393A34">=&gt;</span><span class="token tag script language-javascript" style="color:#00009f"> </span><span class="token tag script language-javascript function" style="color:#d73a49">setShow</span><span class="token tag script language-javascript punctuation" style="color:#393A34">(</span><span class="token tag script language-javascript parameter" style="color:#00009f">show</span><span class="token tag script language-javascript" style="color:#00009f"> </span><span class="token tag script language-javascript operator" style="color:#393A34">=&gt;</span><span class="token tag script language-javascript" style="color:#00009f"> </span><span class="token tag script language-javascript operator" style="color:#393A34">!</span><span class="token tag script language-javascript" style="color:#00009f">show</span><span class="token tag script language-javascript punctuation" style="color:#393A34">)</span><span class="token tag script language-javascript punctuation" style="color:#393A34">}</span><span class="token tag punctuation" style="color:#393A34">&gt;</span><span class="token plain-text">Toggle</span><span class="token tag punctuation" style="color:#393A34">&lt;/</span><span class="token tag" style="color:#00009f">button</span><span class="token tag punctuation" style="color:#393A34">&gt;</span><span class="token plain-text"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain-text">      </span><span class="token tag punctuation" style="color:#393A34">&lt;</span><span class="token tag class-name" style="color:#00009f">Offscreen</span><span class="token tag" style="color:#00009f"> </span><span class="token tag attr-name" style="color:#00a4db">visible</span><span class="token tag script language-javascript script-punctuation punctuation" style="color:#393A34">=</span><span class="token tag script language-javascript punctuation" style="color:#393A34">{</span><span class="token tag script language-javascript" style="color:#00009f">show</span><span class="token tag script language-javascript punctuation" style="color:#393A34">}</span><span class="token tag punctuation" style="color:#393A34">&gt;</span><span class="token plain-text"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain-text">        </span><span class="token tag punctuation" style="color:#393A34">&lt;</span><span class="token tag class-name" style="color:#00009f">Count</span><span class="token tag" style="color:#00009f"> </span><span class="token tag punctuation" style="color:#393A34">/&gt;</span><span class="token plain-text"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain-text">      </span><span class="token tag punctuation" style="color:#393A34">&lt;/</span><span class="token tag class-name" style="color:#00009f">Offscreen</span><span class="token tag punctuation" style="color:#393A34">&gt;</span><span class="token plain-text"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain-text">    </span><span class="token tag punctuation" style="color:#393A34">&lt;/</span><span class="token tag" style="color:#00009f">div</span><span class="token tag punctuation" style="color:#393A34">&gt;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token punctuation" style="color:#393A34">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token operator" style="color:#393A34">...</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token keyword" style="color:#00009f">function</span><span class="token plain"> </span><span class="token function" style="color:#d73a49">Count</span><span class="token punctuation" style="color:#393A34">(</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token keyword" style="color:#00009f">const</span><span class="token plain"> collected </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> </span><span class="token function" style="color:#d73a49">useStillness</span><span class="token punctuation" style="color:#393A34">(</span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token function-variable function" style="color:#d73a49">collect</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">(</span><span class="token parameter">contract</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">=&gt;</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">(</span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      </span><span class="token literal-property property" style="color:#36acaa">stillnessId</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> contract</span><span class="token punctuation" style="color:#393A34">.</span><span class="token function" style="color:#d73a49">getStillnessId</span><span class="token punctuation" style="color:#393A34">(</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      </span><span class="token literal-property property" style="color:#36acaa">unset</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> contract</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">unset</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      </span><span class="token literal-property property" style="color:#36acaa">clear</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> contract</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">clear</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token punctuation" style="color:#393A34">}</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token punctuation" style="color:#393A34">}</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token keyword" style="color:#00009f">return</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token tag punctuation" style="color:#393A34">&lt;</span><span class="token tag" style="color:#00009f">div</span><span class="token tag punctuation" style="color:#393A34">&gt;</span><span class="token plain-text"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain-text">      ....</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain-text">    </span><span class="token tag punctuation" style="color:#393A34">&lt;/</span><span class="token tag" style="color:#00009f">div</span><span class="token tag punctuation" style="color:#393A34">&gt;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token punctuation" style="color:#393A34">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token operator" style="color:#393A34">...</span><br></span></code></pre><button type="button" aria-label="Copy code to clipboard" title="Copy" class="copyButton_eDfN clean-btn"><span class="copyButtonIcons_W9eQ" aria-hidden="true"><svg class="copyButtonIcon_XEyF" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_i9w9" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div><p>ç›¸æ¯”ç›®å‰ç¤¾åŒºä¸­åˆ©ç”¨<code>didMount</code>,<code>unMount</code>çš„èƒ½åŠ›,è¿™é‡Œç®€åŒ–ä¸ºä¸€ä¸ª prop,åŒæ—¶æä¾›ç›¸å…³ hooks,æ¥æ”¯æŒæ‰‹åŠ¨æ§åˆ¶ç¼“å­˜.</p><p>æ ¸å¿ƒå°±æ˜¯:</p><div class="codeBlockContainer_X7hc language-jsx theme-code-block"><div class="codeBlockContent_vqWU" style="color:#393A34;background-color:#f6f8fa"><pre tabindex="0" class="prism-code language-jsx codeBlock_wPnj thin-scrollbar"><code class="codeBlockLines_fQUY"><span class="token-line" style="color:#393A34"><span class="token tag punctuation" style="color:#393A34">&lt;</span><span class="token tag class-name" style="color:#00009f">Offscreen</span><span class="token tag" style="color:#00009f"> </span><span class="token tag attr-name" style="color:#00a4db">visible</span><span class="token tag script language-javascript script-punctuation punctuation" style="color:#393A34">=</span><span class="token tag script language-javascript punctuation" style="color:#393A34">{</span><span class="token tag script language-javascript" style="color:#00009f">show</span><span class="token tag script language-javascript punctuation" style="color:#393A34">}</span><span class="token tag punctuation" style="color:#393A34">&gt;</span><span class="token plain-text"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain-text">  </span><span class="token tag punctuation" style="color:#393A34">&lt;</span><span class="token tag class-name" style="color:#00009f">Count</span><span class="token tag" style="color:#00009f"> </span><span class="token tag punctuation" style="color:#393A34">/&gt;</span><span class="token plain-text"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain-text"></span><span class="token tag punctuation" style="color:#393A34">&lt;/</span><span class="token tag class-name" style="color:#00009f">Offscreen</span><span class="token tag punctuation" style="color:#393A34">&gt;</span><br></span></code></pre><button type="button" aria-label="Copy code to clipboard" title="Copy" class="copyButton_eDfN clean-btn"><span class="copyButtonIcons_W9eQ" aria-hidden="true"><svg class="copyButtonIcon_XEyF" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_i9w9" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div><p>ä¼šä¸ä¼šæœ‰å¾ˆç†Ÿæ‚‰çš„æ„Ÿè§‰,å¦‚æœæŠŠ<code>Offscreen</code>æ¢æˆ<code>div</code>, <code>visible</code>æ¢æˆ<code>visibility:visible|hidden</code>,é‚£ä¹ˆå°±åªæ˜¯ä¸€æ®µæ˜¾éšçš„é€»è¾‘å°±å¯ä»¥å®Œæˆç¼“å­˜çš„å®é™…æ•ˆæœäº† ğŸ˜¬</p><p>å½“ç„¶è¿™é‡Œç¡®å®æ²¡æœ‰è¿™ä¹ˆç®€å•,å¦åˆ™ä¹Ÿä¸ç”¨å•ç‹¬å¼€å‘ç»„ä»¶äº†,ä½†è¿™ç¡®å®æ˜¯ä½œè€…å¸Œæœ›çš„ç»„ä»¶ä½¿ç”¨æ–¹å¼.</p><p><img loading="lazy" alt="åŸç†ç¤ºä¾‹" src="/react-stillness-component/zh-CN/assets/images/1-d463e2d7c7c47ccee1f9e74e6ec89c91.png" width="745" height="362" class="img_E7b_"></p><p>è½¬æ¢ä¸ºä»£ç :</p><div class="codeBlockContainer_X7hc language-jsx theme-code-block"><div class="codeBlockContent_vqWU" style="color:#393A34;background-color:#f6f8fa"><pre tabindex="0" class="prism-code language-jsx codeBlock_wPnj thin-scrollbar"><code class="codeBlockLines_fQUY"><span class="token-line" style="color:#393A34"><span class="token operator" style="color:#393A34">...</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">targetElement </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> document</span><span class="token punctuation" style="color:#393A34">.</span><span class="token function" style="color:#d73a49">createElement</span><span class="token punctuation" style="color:#393A34">(</span><span class="token string" style="color:#e3116c">'div'</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token comment" style="color:#999988;font-style:italic">// didMount</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">containerRef</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">current</span><span class="token punctuation" style="color:#393A34">.</span><span class="token function" style="color:#d73a49">insertAdjacentElement</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token string" style="color:#e3116c">'afterend'</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  targetElement</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">ReactDOM</span><span class="token punctuation" style="color:#393A34">.</span><span class="token function" style="color:#d73a49">createPortal</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">props</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">children</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> targetElement</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token operator" style="color:#393A34">...</span><br></span></code></pre><button type="button" aria-label="Copy code to clipboard" title="Copy" class="copyButton_eDfN clean-btn"><span class="copyButtonIcons_W9eQ" aria-hidden="true"><svg class="copyButtonIcon_XEyF" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_i9w9" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div><p>ç„¶åå°±æ˜¯å¯¹äºæ ¸å¿ƒçš„æ‰©å±•äº†,éœ€è¦è§£å†³åµŒå¥—ä¸‹ <code>&lt;keepAlive&gt;</code> ç›¸å…³ç»„ä»¶è¡Œä¸ºçš„ä¸€è‡´æ€§ä»¥åŠæ•´ä½“çš„ç¼“å­˜æ§åˆ¶.</p><h2 class="anchor anchorWithHideOnScrollNavbar_R0VQ" id="å››åŠŸèƒ½è®¾è®¡">å››.åŠŸèƒ½è®¾è®¡<a class="hash-link" href="#å››åŠŸèƒ½è®¾è®¡" title="Direct link to heading">â€‹</a></h2><p>å‡ºäºå¯¹æ€§èƒ½çš„è€ƒé‡,redux ä¸­å­˜å‚¨çš„åªæ˜¯ç¼“å­˜èŠ‚ç‚¹çš„æ•°æ®æ˜ å°„,åœ¨æ¯ä¸€ä¸ªç¼“å­˜èŠ‚ç‚¹è¢«çœŸå®è½½å…¥ä¹‹å,éƒ½ä¼šåŒæ­¥å»ºç«‹ä¸€ä¸ªå¯¹åº”çš„æ•°æ®èŠ‚ç‚¹,æœ‰äº†ç¬¬ä¸€æ­¥çš„æ•°æ®ä¹‹å,ä¸‹é¢å°±æ˜¯å»ºç«‹å±‚çº§ç»“æ„å³å¯,å¾—ç›Šäº react tree ä»¥åŠ context,å¯ä»¥å¾ˆè½»æ˜“çš„æ¨å¯¼å‡ºæ¯ä¸ªèŠ‚ç‚¹ä¸å…¶ä»–èŠ‚ç‚¹ä¹‹é—´çš„å…³ç³».</p><p><img loading="lazy" alt="contextåº”ç”¨" src="/react-stillness-component/zh-CN/assets/images/3-463f2c92d75001d68b4b9a5d4e903f5a.png" width="1007" height="911" class="img_E7b_"></p><p>æ¯ä¸€å±‚åªè¦æ‹¿åˆ°æœ€è¿‘ä¸€å±‚çš„ <code>StillnessNodeContext</code> ä¸­çš„ id,å°±å¯ä»¥å»ºç«‹åµŒå¥—ç»„ä»¶å…³ç³»çš„æ˜ å°„,</p><p>æ‰€ä»¥å·¥ä½œçš„é‡ç‚¹å¦‚ä¸‹:</p><ul><li>ç¼“å­˜èŠ‚ç‚¹æ•°æ®çŠ¶æ€è®¾è®¡</li><li>èŠ‚ç‚¹ä¹‹é—´çš„çŠ¶æ€åŒæ­¥</li><li>æ€§èƒ½ä¼˜åŒ–,æ‡’åŠ è½½</li></ul><h3 class="anchor anchorWithHideOnScrollNavbar_R0VQ" id="1-çŠ¶æ€æ•°æ®ç»“æ„è®¾è®¡">1. çŠ¶æ€æ•°æ®ç»“æ„è®¾è®¡<a class="hash-link" href="#1-çŠ¶æ€æ•°æ®ç»“æ„è®¾è®¡" title="Direct link to heading">â€‹</a></h3><p><img loading="lazy" alt="çŠ¶æ€è®¾è®¡" src="/react-stillness-component/zh-CN/assets/images/2-ed6016daa3834eafac02570a43d57aa4.png" width="1072" height="623" class="img_E7b_"></p><p>è¿™é‡Œçš„ vNode è¡¨ç°ä¸º:</p><div class="codeBlockContainer_X7hc language-js theme-code-block"><div class="codeBlockContent_vqWU" style="color:#393A34;background-color:#f6f8fa"><pre tabindex="0" class="prism-code language-js codeBlock_wPnj thin-scrollbar"><code class="codeBlockLines_fQUY"><span class="token-line" style="color:#393A34"><span class="token keyword" style="color:#00009f">interface</span><span class="token plain"> </span><span class="token class-name">vNodeState</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token literal-property property" style="color:#36acaa">uniqueId</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> </span><span class="token maybe-class-name">UniqueId</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"> </span><span class="token comment" style="color:#999988;font-style:italic">// å”¯ä¸€æ ‡è¯†</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  type</span><span class="token operator" style="color:#393A34">?</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> </span><span class="token maybe-class-name">UniqueId</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"> </span><span class="token comment" style="color:#999988;font-style:italic">// ç±»å‹</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token literal-property property" style="color:#36acaa">parentId</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> </span><span class="token maybe-class-name">UniqueId</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"> </span><span class="token comment" style="color:#999988;font-style:italic">// çˆ¶èŠ‚ç‚¹æ ‡è¯†</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  visible</span><span class="token operator" style="color:#393A34">?</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> boolean</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"> </span><span class="token comment" style="color:#999988;font-style:italic">// propsä¸­çš„æ˜¾éšå±æ€§</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  isStillness</span><span class="token operator" style="color:#393A34">?</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> boolean</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"> </span><span class="token comment" style="color:#999988;font-style:italic">// è®¡ç®—ä¹‹åçœŸå®çš„é™æ­¢çŠ¶æ€</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token punctuation" style="color:#393A34">}</span><br></span></code></pre><button type="button" aria-label="Copy code to clipboard" title="Copy" class="copyButton_eDfN clean-btn"><span class="copyButtonIcons_W9eQ" aria-hidden="true"><svg class="copyButtonIcon_XEyF" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_i9w9" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div><p>operation å¯èƒ½ä¸å¤ªå¥½ç†è§£,è¿™é‡Œä¸»è¦ç”¨æ¥æ ‡è®°ä¸€äº›å¯èƒ½ä¼šå½±å“å…¨å±€ä¸­èŠ‚ç‚¹çš„è¡Œä¸º,æ¯”å¦‚:</p><ul><li>unset: é‡ç½®é™æ­¢èŠ‚ç‚¹çš„å†å²çŠ¶æ€</li><li>clear: é‡ç½®æ‰€æœ‰é™æ­¢èŠ‚ç‚¹çš„å†å²çŠ¶æ€</li><li>mount: æœ‰èŠ‚ç‚¹è§¦å‘äº†é™æ­¢çŠ¶æ€</li><li>unmount: æœ‰èŠ‚ç‚¹è„±ç¦»äº†é™æ­¢çŠ¶æ€</li></ul><p>å½“ä¸Šè¿°ä»»ä½•ä¸€ä¸ªäº‹ä»¶è§¦å‘æ—¶,éƒ½éœ€è¦æ ¹æ®èµ·å§‹èŠ‚ç‚¹äº§ç”Ÿä¾èµ–å½±å“æ›´æ”¹,æœ‰çš„æ—¶å€™ç”šè‡³éœ€è¦å°†æ‰€æœ‰ç¼“å­˜èŠ‚ç‚¹éƒ½æ›´æ–°ä¸€é.</p><p>max åˆ™æä¾›äº†è‡ªåŠ¨æ§åˆ¶ç¼“å­˜çš„æ–¹æ³•,å½“ç”¨æˆ·å£°æ˜æœ€å¤§ç¼“å­˜èŠ‚ç‚¹æ•°é‡æ—¶,ç»„ä»¶ä¼šæ ¹æ®è§„åˆ™(ç¬¬ä¸€å±‚<code>&lt;Offscreen&gt;</code>èŠ‚ç‚¹æ‰ä¼šç®—ä½œæ˜¯ä¸€ä¸ªèŠ‚ç‚¹,å…¶å­èŠ‚ç‚¹å…¨éƒ¨è·Ÿéšçˆ¶èŠ‚ç‚¹)å¹¶åˆ©ç”¨ <code>lru</code> ç®—æ³•è‡ªåŠ¨æ¸…é™¤æˆ–åŠ å…¥ç¼“å­˜ä¹‹ä¸­.</p><h3 class="anchor anchorWithHideOnScrollNavbar_R0VQ" id="2-çŠ¶æ€åŒæ­¥">2. çŠ¶æ€åŒæ­¥<a class="hash-link" href="#2-çŠ¶æ€åŒæ­¥" title="Direct link to heading">â€‹</a></h3><p>è¿™é‡Œçš„åŒæ­¥ä¸»è¦æŒ‡çš„å°±æ˜¯çˆ¶èŠ‚ç‚¹è§¦å‘äº†é™æ­¢æ“ä½œä¹‹å,éœ€è¦å®æ—¶é€šçŸ¥åˆ°å…¶ä¸‹çš„æ‰€æœ‰å­èŠ‚ç‚¹.å¾—ç›Šäºæ•°æ®ç»“æ„çš„è®¾è®¡,å½“ä¸€ä¸ªèŠ‚ç‚¹è§¦å‘äº†é™æ­¢æˆ–è€…è§£é™¤äº†é™æ­¢æ“ä½œä¹‹å,éƒ½å¯ä»¥æ ¹æ® <code>uniqueId</code> ä»¥åŠ <code>parentId</code> è®¡ç®—å‡ºæ‰€æœ‰éœ€è¦å˜æ›´çŠ¶æ€çš„èŠ‚ç‚¹</p><p><img loading="lazy" alt="çŠ¶æ€åŒæ­¥" src="/react-stillness-component/zh-CN/assets/images/4-614cc2c7c4c77015bc607fd147040bc7.png" width="406" height="197" class="img_E7b_"></p><h3 class="anchor anchorWithHideOnScrollNavbar_R0VQ" id="3-æ€§èƒ½ä¼˜åŒ–">3. æ€§èƒ½ä¼˜åŒ–<a class="hash-link" href="#3-æ€§èƒ½ä¼˜åŒ–" title="Direct link to heading">â€‹</a></h3><p>æ€§èƒ½ä¼˜åŒ–ä¸»è¦ä½“ç°åœ¨ä¸¤ä¸ªæ–¹é¢</p><ul><li>å±€éƒ¨æ›´æ–°:åˆ©ç”¨äº† redux,ä»¥åŠçŠ¶æ€æ•°æ®ç»“æ„è®¾è®¡,æ¯æ¬¡æ›´æ–°èŠ‚ç‚¹çŠ¶æ€åªä¼šå½±å“ç›¸å…³è”çš„èŠ‚ç‚¹</li><li>æ‡’åŠ è½½:å®é™…ä¸Š <code>&lt;Offscreen&gt;</code> èŠ‚ç‚¹ä¸Šçš„ <code>visible</code> å±æ€§æ˜¯å¯ä»¥è¿›è¡Œä¼˜åŒ–çš„,å¦‚æœä¸€å¼€å§‹<code>visible</code>å±æ€§å°±ä¸º<code>false</code>,åˆ™<code>children</code> æ˜¯ä¸éœ€è¦ç›´æ¥åŠ è½½çš„</li></ul><div class="codeBlockContainer_X7hc language-jsx theme-code-block"><div class="codeBlockContent_vqWU" style="color:#393A34;background-color:#f6f8fa"><pre tabindex="0" class="prism-code language-jsx codeBlock_wPnj thin-scrollbar"><code class="codeBlockLines_fQUY"><span class="token-line" style="color:#393A34"><span class="token function" style="color:#d73a49">useIsomorphicLayoutEffect</span><span class="token punctuation" style="color:#393A34">(</span><span class="token punctuation" style="color:#393A34">(</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">=&gt;</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token keyword" style="color:#00009f">if</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">isMountRef</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">current</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token keyword" style="color:#00009f">const</span><span class="token plain"> parentIsStillness </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> globalMonitor</span><span class="token punctuation" style="color:#393A34">.</span><span class="token function" style="color:#d73a49">isStillness</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">stillnessParentId</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    uniqueNodeRegistration</span><span class="token punctuation" style="color:#393A34">.</span><span class="token function" style="color:#d73a49">update</span><span class="token punctuation" style="color:#393A34">(</span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      </span><span class="token operator" style="color:#393A34">...</span><span class="token plain">props</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      </span><span class="token literal-property property" style="color:#36acaa">parentId</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> stillnessParentId</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      </span><span class="token literal-property property" style="color:#36acaa">isStillness</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> parentIsStillness </span><span class="token operator" style="color:#393A34">||</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">!</span><span class="token plain">props</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">visible</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token punctuation" style="color:#393A34">}</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token comment" style="color:#999988;font-style:italic">// è·å–åˆ°çœŸå®é™æ­¢çŠ¶æ€</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token keyword" style="color:#00009f">const</span><span class="token plain"> thisIsStillness </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> globalMonitor</span><span class="token punctuation" style="color:#393A34">.</span><span class="token function" style="color:#d73a49">isStillness</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      uniqueNodeRegistration</span><span class="token punctuation" style="color:#393A34">.</span><span class="token function" style="color:#d73a49">getUniqueId</span><span class="token punctuation" style="color:#393A34">(</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token operator" style="color:#393A34">...</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token keyword" style="color:#00009f">if</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">(</span><span class="token operator" style="color:#393A34">!</span><span class="token plain">thisIsStillness</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      </span><span class="token function" style="color:#d73a49">setIsCurrentlyMounted</span><span class="token punctuation" style="color:#393A34">(</span><span class="token boolean" style="color:#36acaa">true</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token punctuation" style="color:#393A34">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token punctuation" style="color:#393A34">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token punctuation" style="color:#393A34">}</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">[</span><span class="token plain">props</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> stillnessParentId</span><span class="token punctuation" style="color:#393A34">]</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token function" style="color:#d73a49">useEffect</span><span class="token punctuation" style="color:#393A34">(</span><span class="token punctuation" style="color:#393A34">(</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">=&gt;</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token keyword" style="color:#00009f">if</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">isCurrentlyMounted </span><span class="token operator" style="color:#393A34">===</span><span class="token plain"> </span><span class="token boolean" style="color:#36acaa">false</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token keyword" style="color:#00009f">if</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">isMountRef</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">current</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      </span><span class="token function" style="color:#d73a49">setIsCurrentlyMounted</span><span class="token punctuation" style="color:#393A34">(</span><span class="token boolean" style="color:#36acaa">true</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token punctuation" style="color:#393A34">}</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">else</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      isMountRef</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">current </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> </span><span class="token boolean" style="color:#36acaa">true</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token punctuation" style="color:#393A34">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token punctuation" style="color:#393A34">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token punctuation" style="color:#393A34">}</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">[</span><span class="token plain">isCurrentlyMounted</span><span class="token punctuation" style="color:#393A34">]</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token keyword" style="color:#00009f">const</span><span class="token plain"> RenderedWrappedComponent </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> </span><span class="token function" style="color:#d73a49">useMemo</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token punctuation" style="color:#393A34">(</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">=&gt;</span><span class="token plain"> </span><span class="token tag punctuation" style="color:#393A34">&lt;</span><span class="token tag class-name" style="color:#00009f">Decorated</span><span class="token tag" style="color:#00009f"> </span><span class="token tag spread punctuation" style="color:#393A34">{</span><span class="token tag spread operator" style="color:#393A34">...</span><span class="token tag spread" style="color:#00009f">wrapperProps</span><span class="token tag spread punctuation" style="color:#393A34">}</span><span class="token tag" style="color:#00009f"> </span><span class="token tag punctuation" style="color:#393A34">/&gt;</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token punctuation" style="color:#393A34">[</span><span class="token plain">wrapperProps</span><span class="token punctuation" style="color:#393A34">]</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token keyword" style="color:#00009f">return</span><span class="token plain"> isCurrentlyMounted </span><span class="token operator" style="color:#393A34">?</span><span class="token plain"> RenderedWrappedComponent </span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">null</span><span class="token punctuation" style="color:#393A34">;</span><br></span></code></pre><button type="button" aria-label="Copy code to clipboard" title="Copy" class="copyButton_eDfN clean-btn"><span class="copyButtonIcons_W9eQ" aria-hidden="true"><svg class="copyButtonIcon_XEyF" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_i9w9" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div><p>è¿™é‡Œåªéœ€è¦æ³¨æ„æœ‰å¯èƒ½çˆ¶èŠ‚ç‚¹å·²ç»æ˜¯é™æ­¢çŠ¶æ€äº†,æ‰€ä»¥å­èŠ‚ç‚¹å³ä½¿<code>visible</code>ä¸º<code>true</code>,ä½†ä¹Ÿæ˜¯éœ€è¦æ‡’åŠ è½½çš„.</p><h3 class="anchor anchorWithHideOnScrollNavbar_R0VQ" id="4-æ»šåŠ¨çŠ¶æ€è®°å¿†">4. æ»šåŠ¨çŠ¶æ€è®°å¿†<a class="hash-link" href="#4-æ»šåŠ¨çŠ¶æ€è®°å¿†" title="Direct link to heading">â€‹</a></h3><p>å› ä¸ºèŠ‚ç‚¹ç»è¿‡ DOM æ“ä½œä¹‹åä¼šé‡ç½®æ»šåŠ¨ä½ç½®,æ‰€ä»¥æˆ‘ä»¬éœ€è¦æŠŠ <code>&lt;Offscreen&gt;</code>ä¸‹çš„ç¬¬ä¸€å±‚ dom èŠ‚ç‚¹çš„æ»šåŠ¨çŠ¶æ€è®°å½•ä¸‹æ¥,åœ¨è§£é™¤é™æ­¢çŠ¶æ€æ—¶å†è¿›è¡Œè®¾å€¼å³å¯è¿˜åŸ</p><div class="codeBlockContainer_X7hc language-jsx theme-code-block"><div class="codeBlockContent_vqWU" style="color:#393A34;background-color:#f6f8fa"><pre tabindex="0" class="prism-code language-jsx codeBlock_wPnj thin-scrollbar"><code class="codeBlockLines_fQUY"><span class="token-line" style="color:#393A34"><span class="token function-variable function" style="color:#d73a49">listenerTargetElementChildScroll</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">(</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">=&gt;</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token keyword" style="color:#00009f">if</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">(</span><span class="token keyword" style="color:#00009f">this</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">props</span><span class="token operator" style="color:#393A34">?.</span><span class="token plain">scrollReset</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token keyword" style="color:#00009f">this</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">targetElement</span><span class="token punctuation" style="color:#393A34">.</span><span class="token function" style="color:#d73a49">addEventListener</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      </span><span class="token string" style="color:#e3116c">'scroll'</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      </span><span class="token function" style="color:#d73a49">throttle</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token punctuation" style="color:#393A34">(</span><span class="token parameter literal-property property" style="color:#36acaa">e</span><span class="token parameter operator" style="color:#393A34">:</span><span class="token parameter"> any</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">=&gt;</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">          </span><span class="token keyword" style="color:#00009f">if</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">(</span><span class="token function" style="color:#d73a49">isRealChildNode</span><span class="token punctuation" style="color:#393A34">(</span><span class="token keyword" style="color:#00009f">this</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">targetElement</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> e</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">target</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            </span><span class="token keyword" style="color:#00009f">let</span><span class="token plain"> index </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">this</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">cacheNodes</span><span class="token punctuation" style="color:#393A34">.</span><span class="token function" style="color:#d73a49">findIndex</span><span class="token punctuation" style="color:#393A34">(</span><span class="token punctuation" style="color:#393A34">(</span><span class="token parameter">el</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">=&gt;</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">              </span><span class="token keyword" style="color:#00009f">return</span><span class="token plain"> el</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">node </span><span class="token operator" style="color:#393A34">===</span><span class="token plain"> e</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">target</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            </span><span class="token punctuation" style="color:#393A34">}</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            </span><span class="token keyword" style="color:#00009f">if</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">index </span><span class="token operator" style="color:#393A34">!==</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">-</span><span class="token number" style="color:#36acaa">1</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">              </span><span class="token keyword" style="color:#00009f">this</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">cacheNodes</span><span class="token punctuation" style="color:#393A34">[</span><span class="token plain">index</span><span class="token punctuation" style="color:#393A34">]</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                </span><span class="token literal-property property" style="color:#36acaa">node</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> e</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">target</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                </span><span class="token literal-property property" style="color:#36acaa">left</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> e</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">target</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">scrollLeft </span><span class="token operator" style="color:#393A34">||</span><span class="token plain"> </span><span class="token number" style="color:#36acaa">0</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                </span><span class="token literal-property property" style="color:#36acaa">top</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> e</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">target</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">scrollTop </span><span class="token operator" style="color:#393A34">||</span><span class="token plain"> </span><span class="token number" style="color:#36acaa">0</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">              </span><span class="token punctuation" style="color:#393A34">}</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            </span><span class="token punctuation" style="color:#393A34">}</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">else</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">              </span><span class="token keyword" style="color:#00009f">this</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">cacheNodes</span><span class="token punctuation" style="color:#393A34">.</span><span class="token function" style="color:#d73a49">push</span><span class="token punctuation" style="color:#393A34">(</span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                </span><span class="token literal-property property" style="color:#36acaa">node</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> e</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">target</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                </span><span class="token literal-property property" style="color:#36acaa">left</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> e</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">target</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">scrollLeft </span><span class="token operator" style="color:#393A34">||</span><span class="token plain"> </span><span class="token number" style="color:#36acaa">0</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                </span><span class="token literal-property property" style="color:#36acaa">top</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> e</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">target</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">scrollTop </span><span class="token operator" style="color:#393A34">||</span><span class="token plain"> </span><span class="token number" style="color:#36acaa">0</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">              </span><span class="token punctuation" style="color:#393A34">}</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            </span><span class="token punctuation" style="color:#393A34">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">          </span><span class="token punctuation" style="color:#393A34">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token punctuation" style="color:#393A34">}</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token keyword" style="color:#00009f">this</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token number" style="color:#36acaa">120</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      </span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      </span><span class="token boolean" style="color:#36acaa">true</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token punctuation" style="color:#393A34">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token punctuation" style="color:#393A34">}</span><span class="token punctuation" style="color:#393A34">;</span><br></span></code></pre><button type="button" aria-label="Copy code to clipboard" title="Copy" class="copyButton_eDfN clean-btn"><span class="copyButtonIcons_W9eQ" aria-hidden="true"><svg class="copyButtonIcon_XEyF" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_i9w9" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div><p>è¿™é‡Œå› ä¸ºæ¶‰åŠåˆ°çˆ¶å­åµŒå¥—ç»„ä»¶,æ‰€ä»¥ä½œè€…é‡‡ç”¨äº†äº‹ä»¶ç›‘å¬çš„æ–¹æ³•,åœ¨æ¯ä¸ª <code>&lt;Offscreen&gt;</code> èŠ‚ç‚¹ä¸‹äº§ç”Ÿæ»šåŠ¨äº‹ä»¶æ—¶,å¯¹å…¶ä¸‹çš„æ»šåŠ¨å…ƒç´ è¿›è¡Œè®°å¿†,å¹¶ä¿å­˜åœ¨è¯¥èŠ‚ç‚¹çš„ä½œç”¨åŸŸä¸­.</p><h3 class="anchor anchorWithHideOnScrollNavbar_R0VQ" id="5-hoc">5. HOC<a class="hash-link" href="#5-hoc" title="Direct link to heading">â€‹</a></h3><p>è§£å†³äº†æœ€é‡è¦çš„é—®é¢˜ä¹‹å,åé¢å°±æ˜¯æä¾›å„ç§å¿«æ·çš„ä½¿ç”¨æ–¹æ³•äº†,è¯¥ç»„ä»¶æ”¯æŒ<code>HOC</code>å’Œ<code>Hooks</code>çš„ç”¨æ³•,</p><p><code>HOC</code> åªéœ€è¦æä¾›ä¸€ä¸ª<code>spec</code>å³å¯:</p><div class="codeBlockContainer_X7hc language-jsx theme-code-block"><div class="codeBlockContent_vqWU" style="color:#393A34;background-color:#f6f8fa"><pre tabindex="0" class="prism-code language-jsx codeBlock_wPnj thin-scrollbar"><code class="codeBlockLines_fQUY"><span class="token-line" style="color:#393A34"><span class="token keyword" style="color:#00009f">import</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"> connectStillness </span><span class="token punctuation" style="color:#393A34">}</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">from</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">'react-stillness-component'</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token operator" style="color:#393A34">...</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token keyword" style="color:#00009f">const</span><span class="token plain"> spec </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token function-variable function" style="color:#d73a49">mounted</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">(</span><span class="token parameter">props</span><span class="token parameter punctuation" style="color:#393A34">,</span><span class="token parameter"> contract</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">=&gt;</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token keyword" style="color:#00009f">return</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">'mounted'</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token punctuation" style="color:#393A34">}</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token function-variable function" style="color:#d73a49">unmounted</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">(</span><span class="token parameter">props</span><span class="token parameter punctuation" style="color:#393A34">,</span><span class="token parameter"> contract</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">=&gt;</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token keyword" style="color:#00009f">return</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">'unmounted'</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token punctuation" style="color:#393A34">}</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token function-variable function" style="color:#d73a49">collect</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">(</span><span class="token parameter">props</span><span class="token parameter punctuation" style="color:#393A34">,</span><span class="token parameter"> contract</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">=&gt;</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token keyword" style="color:#00009f">return</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      </span><span class="token literal-property property" style="color:#36acaa">isStillness</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> contract</span><span class="token punctuation" style="color:#393A34">.</span><span class="token function" style="color:#d73a49">isStillness</span><span class="token punctuation" style="color:#393A34">(</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      </span><span class="token literal-property property" style="color:#36acaa">stillnessId</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> contract</span><span class="token punctuation" style="color:#393A34">.</span><span class="token function" style="color:#d73a49">getStillnessId</span><span class="token punctuation" style="color:#393A34">(</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token punctuation" style="color:#393A34">}</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token punctuation" style="color:#393A34">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token punctuation" style="color:#393A34">}</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token keyword" style="color:#00009f">export</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">const</span><span class="token plain"> WithCount </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> </span><span class="token function" style="color:#d73a49">connectStillness</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">spec</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">CountComponent</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token operator" style="color:#393A34">...</span><br></span></code></pre><button type="button" aria-label="Copy code to clipboard" title="Copy" class="copyButton_eDfN clean-btn"><span class="copyButtonIcons_W9eQ" aria-hidden="true"><svg class="copyButtonIcon_XEyF" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_i9w9" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div><p><code>spec</code> å‚æ•°<a href="https://leomyili.github.io/react-stillness-component/zh-CN/docs/api/Decorators/connectStillness" target="_blank" rel="noopener noreferrer">å¯ä»¥å‚è€ƒ</a></p><p><code>spec</code>ä¸­<code>collect</code>å‡½æ•°è¿”å›çš„å€¼å°±æ˜¯ç»„ä»¶æ–°çš„<code>props</code>;</p><h3 class="anchor anchorWithHideOnScrollNavbar_R0VQ" id="6-hook">6. Hook<a class="hash-link" href="#6-hook" title="Direct link to heading">â€‹</a></h3><p><code>Hooks</code>æ–¹é¢ä¸»è¦æœ‰ä¸¤ä¸ª<code>hook</code>æ¥å¸®åŠ©ç”¨æˆ·æ›´å¥½çš„å®Œæˆç¼“å­˜èŠ‚ç‚¹çš„æ§åˆ¶</p><ul><li>useStillnessManager:ååº•å±‚ä¸€äº›,å°†å†…éƒ¨çš„æ–¹æ³•ä¹Ÿåšäº†ä¸€å®šçš„å½’çº³,å¹¶æä¾›ç»™ç”¨æˆ·è¿›è¡Œè‡ªå®šä¹‰</li><li>useStillness:ä¸<code>connectStillness</code>æ•ˆæœä¸€è‡´</li></ul><div class="codeBlockContainer_X7hc language-jsx theme-code-block"><div class="codeBlockContent_vqWU" style="color:#393A34;background-color:#f6f8fa"><pre tabindex="0" class="prism-code language-jsx codeBlock_wPnj thin-scrollbar"><code class="codeBlockLines_fQUY"><span class="token-line" style="color:#393A34"><span class="token keyword" style="color:#00009f">import</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"> useStillness</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> useStillnessManager </span><span class="token punctuation" style="color:#393A34">}</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">from</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">'react-stillness-component'</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token keyword" style="color:#00009f">function</span><span class="token plain"> </span><span class="token function" style="color:#d73a49">Count</span><span class="token punctuation" style="color:#393A34">(</span><span class="token parameter">props</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token keyword" style="color:#00009f">const</span><span class="token plain"> stillnessManager </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> </span><span class="token function" style="color:#d73a49">useStillnessManager</span><span class="token punctuation" style="color:#393A34">(</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token comment" style="color:#999988;font-style:italic">// stillnessManager.getStore();</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token keyword" style="color:#00009f">const</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">[</span><span class="token plain">count</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> setCount</span><span class="token punctuation" style="color:#393A34">]</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> </span><span class="token function" style="color:#d73a49">useState</span><span class="token punctuation" style="color:#393A34">(</span><span class="token number" style="color:#36acaa">0</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token keyword" style="color:#00009f">const</span><span class="token plain"> collected </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> </span><span class="token function" style="color:#d73a49">useStillness</span><span class="token punctuation" style="color:#393A34">(</span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token function-variable function" style="color:#d73a49">mounted</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">(</span><span class="token parameter">contract</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">=&gt;</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      </span><span class="token keyword" style="color:#00009f">return</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">'mounted'</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token punctuation" style="color:#393A34">}</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token function-variable function" style="color:#d73a49">unmounted</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">(</span><span class="token parameter">contract</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">=&gt;</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      </span><span class="token keyword" style="color:#00009f">return</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">'unmounted'</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token punctuation" style="color:#393A34">}</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token function-variable function" style="color:#d73a49">collect</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">(</span><span class="token parameter">contract</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">=&gt;</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      </span><span class="token keyword" style="color:#00009f">return</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token literal-property property" style="color:#36acaa">isStillness</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> contract</span><span class="token punctuation" style="color:#393A34">.</span><span class="token function" style="color:#d73a49">isStillness</span><span class="token punctuation" style="color:#393A34">(</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token literal-property property" style="color:#36acaa">stillnessId</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> contract</span><span class="token punctuation" style="color:#393A34">.</span><span class="token function" style="color:#d73a49">getStillnessId</span><span class="token punctuation" style="color:#393A34">(</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token literal-property property" style="color:#36acaa">item</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> contract</span><span class="token punctuation" style="color:#393A34">.</span><span class="token function" style="color:#d73a49">getStillnessItem</span><span class="token punctuation" style="color:#393A34">(</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      </span><span class="token punctuation" style="color:#393A34">}</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token punctuation" style="color:#393A34">}</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token punctuation" style="color:#393A34">}</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token function" style="color:#d73a49">useEffect</span><span class="token punctuation" style="color:#393A34">(</span><span class="token punctuation" style="color:#393A34">(</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">=&gt;</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    console</span><span class="token punctuation" style="color:#393A34">.</span><span class="token function" style="color:#d73a49">log</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">collected</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token punctuation" style="color:#393A34">}</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">[</span><span class="token plain">collected</span><span class="token punctuation" style="color:#393A34">]</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token keyword" style="color:#00009f">return</span><span class="token plain"> </span><span class="token tag punctuation" style="color:#393A34">&lt;</span><span class="token tag" style="color:#00009f">div</span><span class="token tag punctuation" style="color:#393A34">&gt;</span><span class="token plain-text">...</span><span class="token tag punctuation" style="color:#393A34">&lt;/</span><span class="token tag" style="color:#00009f">div</span><span class="token tag punctuation" style="color:#393A34">&gt;</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token punctuation" style="color:#393A34">}</span><br></span></code></pre><button type="button" aria-label="Copy code to clipboard" title="Copy" class="copyButton_eDfN clean-btn"><span class="copyButtonIcons_W9eQ" aria-hidden="true"><svg class="copyButtonIcon_XEyF" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_i9w9" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div><p>ä»¥ä¸Šå°±æ˜¯æ•´ä½“çš„æ¶æ„è®¾è®¡.æœ‰å…´è¶£çš„å°ä¼™ä¼´å¯ä»¥çœ‹ä¸‹æºç ,ç»“æ„å€Ÿé‰´äº†<code>react-dnd</code>çš„æƒ³æ³•,ä¹Ÿç®—æ˜¯é‡æ–°é˜…è¯»äº†ä¸€éå®ƒçš„æ•°æ®çŠ¶æ€ä¸ UI åˆ†ç¦»æ˜¯å¦‚ä½•è®¾è®¡çš„.</p><p>ä¹‹åä¼šç»™å¤§å®¶æ¼”ç¤ºä¸€é <code>react-stillness-component</code> çš„å®é™…åº”ç”¨.</p><h2 class="anchor anchorWithHideOnScrollNavbar_R0VQ" id="äº”å®æˆ˜æ¼”ç»ƒ">äº”.å®æˆ˜æ¼”ç»ƒ<a class="hash-link" href="#äº”å®æˆ˜æ¼”ç»ƒ" title="Direct link to heading">â€‹</a></h2><p>ä»¥ä¸‹æä¾›çš„ä¾‹å­ä»…ä»…æ˜¯ä½œè€…æ ¹æ®è‡ªèº«æƒ…å†µä»è€Œç¼–å†™çš„ä¾‹å­,å®é™…ä¸Šç»„ä»¶æœ¬èº«çš„åŠŸèƒ½éå¸¸ç®€å•,å¹¶æ²¡æœ‰å¾ˆæ˜æ˜¾çš„å…¼å®¹é—®é¢˜,å¦‚æœæœ‰ç»“åˆå…¶ä»–åº“æ— æ³•è¾¾åˆ°æ•ˆæœçš„æƒ…å†µ,ä¹Ÿæ¬¢è¿è”ç³»ä½œè€….</p><h3 class="anchor anchorWithHideOnScrollNavbar_R0VQ" id="1-é¦–å…ˆæ˜¯ç®€å•-demo">1. é¦–å…ˆæ˜¯ç®€å• demo<a class="hash-link" href="#1-é¦–å…ˆæ˜¯ç®€å•-demo" title="Direct link to heading">â€‹</a></h3><p><img loading="lazy" alt="ç®€å•å®ä¾‹" src="/react-stillness-component/zh-CN/assets/images/5-ba36f59a29839136027fd63f1e6faefa.gif" width="456" height="504" class="img_E7b_"></p><p>å¯ä»¥é€šè¿‡<a href="https://codesandbox.io/s/02-example-react-379q3k?from-embed" target="_blank" rel="noopener noreferrer">åœ¨çº¿ demo</a>æŸ¥çœ‹å…·ä½“æ•ˆæœ.</p><h3 class="anchor anchorWithHideOnScrollNavbar_R0VQ" id="2-ç„¶åå°±æ˜¯æœ€å¸¸è§çš„-react-router-è¿™é‡Œåˆ†ä¸º-v5-ç‰ˆæœ¬å’Œ-v6-ç‰ˆæœ¬">2. ç„¶åå°±æ˜¯æœ€å¸¸è§çš„ <code>react-router</code> ,è¿™é‡Œåˆ†ä¸º v5 ç‰ˆæœ¬å’Œ v6 ç‰ˆæœ¬<a class="hash-link" href="#2-ç„¶åå°±æ˜¯æœ€å¸¸è§çš„-react-router-è¿™é‡Œåˆ†ä¸º-v5-ç‰ˆæœ¬å’Œ-v6-ç‰ˆæœ¬" title="Direct link to heading">â€‹</a></h3><p><img loading="lazy" alt="react-router v5" src="/react-stillness-component/zh-CN/assets/images/6-0afa471616e87cac59f0c71ec2fed6b6.gif" width="468" height="500" class="img_E7b_"></p><p><code>react-router-v5</code>ä¸­æœ€ä¸»è¦çš„è¿˜æ˜¯è‡ªå®šä¹‰äº†<code>&lt;Switch&gt;</code>ç»„ä»¶,ä»è€Œè¾¾åˆ°äº†è·¯ç”±ç¼“å­˜çš„æ•ˆæœ,æ›´å¤šè¯¦ç»†ä»‹ç»,<a href="https://leomyili.github.io/react-stillness-component/zh-CN/docs/examples/react-router/v5" target="_blank" rel="noopener noreferrer">å¯ä»¥å‚è€ƒ</a>,å¹¶è‡ªè¡Œè°ƒè¯•</p><p><img loading="lazy" alt="react-router v6" src="/react-stillness-component/zh-CN/assets/images/7-d437f0c269c8dd8b21e378fdb790ff1a.gif" width="472" height="510" class="img_E7b_"></p><p><code>react-router-v6</code>ç‰ˆæœ¬å°±ç®€å•äº†å¾ˆå¤š,åªéœ€è¦å®šåˆ¶outlet,å°±å¯ä»¥è¾¾åˆ°ç¼“å­˜çš„æ•ˆæœ,æºç <a href="https://codesandbox.io/s/04-example-react-routerv6-uuv2xc?from-embed" target="_blank" rel="noopener noreferrer">å¯ä»¥å‚è€ƒ</a>,å¹¶è‡ªè¡Œè°ƒè¯•</p><h3 class="anchor anchorWithHideOnScrollNavbar_R0VQ" id="3-ç„¶åæ˜¯åœ¨-umi-v3-æ¡†æ¶ä¸­çš„åº”ç”¨è¿™ä¹Ÿæ˜¯ä½œè€…ç›®å‰æ‰€åœ¨å›¢é˜Ÿçš„åŸºç¡€æ¡†æ¶">3. ç„¶åæ˜¯åœ¨ <code>umi v3</code> æ¡†æ¶ä¸­çš„åº”ç”¨,è¿™ä¹Ÿæ˜¯ä½œè€…ç›®å‰æ‰€åœ¨å›¢é˜Ÿçš„åŸºç¡€æ¡†æ¶<a class="hash-link" href="#3-ç„¶åæ˜¯åœ¨-umi-v3-æ¡†æ¶ä¸­çš„åº”ç”¨è¿™ä¹Ÿæ˜¯ä½œè€…ç›®å‰æ‰€åœ¨å›¢é˜Ÿçš„åŸºç¡€æ¡†æ¶" title="Direct link to heading">â€‹</a></h3><p>é¦–å…ˆéœ€è¦å®‰è£…å·²å°è£…å¥½çš„æ’ä»¶ <code>yarn add umi-plugin-stillness react-stillness-component</code>;</p><p>å…¶æ¬¡åœ¨<code>.umirc.ts</code>ä¸­è¿›è¡Œä½¿ç”¨:</p><div class="codeBlockContainer_X7hc language-js theme-code-block"><div class="codeBlockContent_vqWU" style="color:#393A34;background-color:#f6f8fa"><pre tabindex="0" class="prism-code language-js codeBlock_wPnj thin-scrollbar"><code class="codeBlockLines_fQUY"><span class="token-line" style="color:#393A34"><span class="token keyword module" style="color:#00009f">import</span><span class="token plain"> </span><span class="token imports punctuation" style="color:#393A34">{</span><span class="token imports"> defineConfig </span><span class="token imports punctuation" style="color:#393A34">}</span><span class="token plain"> </span><span class="token keyword module" style="color:#00009f">from</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">'umi'</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token keyword module" style="color:#00009f">export</span><span class="token plain"> </span><span class="token keyword module" style="color:#00009f">default</span><span class="token plain"> </span><span class="token function" style="color:#d73a49">defineConfig</span><span class="token punctuation" style="color:#393A34">(</span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token literal-property property" style="color:#36acaa">nodeModulesTransform</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token literal-property property" style="color:#36acaa">type</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">'none'</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token punctuation" style="color:#393A34">}</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token literal-property property" style="color:#36acaa">routes</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">[</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      </span><span class="token literal-property property" style="color:#36acaa">exact</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> </span><span class="token boolean" style="color:#36acaa">false</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      </span><span class="token literal-property property" style="color:#36acaa">path</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">'/'</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      </span><span class="token literal-property property" style="color:#36acaa">component</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">'@/layouts/index'</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      </span><span class="token literal-property property" style="color:#36acaa">routes</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">[</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">          </span><span class="token literal-property property" style="color:#36acaa">exact</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> </span><span class="token boolean" style="color:#36acaa">false</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">          </span><span class="token literal-property property" style="color:#36acaa">path</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">'/home'</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">          </span><span class="token literal-property property" style="color:#36acaa">component</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">'@/pages/home'</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">          </span><span class="token literal-property property" style="color:#36acaa">stillness</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> </span><span class="token boolean" style="color:#36acaa">true</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">          </span><span class="token literal-property property" style="color:#36acaa">routes</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">[</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">              </span><span class="token literal-property property" style="color:#36acaa">path</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">'/home/a'</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">              </span><span class="token literal-property property" style="color:#36acaa">component</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">'@/pages/a'</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">              </span><span class="token literal-property property" style="color:#36acaa">stillness</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> </span><span class="token boolean" style="color:#36acaa">true</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            </span><span class="token punctuation" style="color:#393A34">}</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">          </span><span class="token punctuation" style="color:#393A34">]</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token punctuation" style="color:#393A34">}</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"> </span><span class="token literal-property property" style="color:#36acaa">path</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">'/about'</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> </span><span class="token literal-property property" style="color:#36acaa">component</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">'@/pages/about'</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> </span><span class="token literal-property property" style="color:#36acaa">stillness</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> </span><span class="token boolean" style="color:#36acaa">true</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">}</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"> </span><span class="token literal-property property" style="color:#36acaa">path</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">'/list'</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> </span><span class="token literal-property property" style="color:#36acaa">component</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">'@/pages/list'</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">}</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      </span><span class="token punctuation" style="color:#393A34">]</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token punctuation" style="color:#393A34">}</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token punctuation" style="color:#393A34">]</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token literal-property property" style="color:#36acaa">stillness</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token punctuation" style="color:#393A34">}</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token punctuation" style="color:#393A34">}</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">;</span><br></span></code></pre><button type="button" aria-label="Copy code to clipboard" title="Copy" class="copyButton_eDfN clean-btn"><span class="copyButtonIcons_W9eQ" aria-hidden="true"><svg class="copyButtonIcon_XEyF" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_i9w9" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div><p>éœ€è¦åšç¼“å­˜å¤„ç†çš„èŠ‚ç‚¹å¢åŠ <code>stillness:true</code>å³å¯</p><p>æ•ˆæœ:</p><p><img loading="lazy" alt="umi demo" src="/react-stillness-component/zh-CN/assets/images/8-4036a56c04ffd30df6d20c32cff26ec3.gif" width="944" height="502" class="img_E7b_"></p><p>å…¶ä¸­æœ€é‡è¦çš„è¿˜æ˜¯è‡ªå®šä¹‰<code>&lt;Switch&gt;</code>ç»„ä»¶,ä½¿ç”¨ <code>modifyRendererPath</code> èƒ½åŠ›,é‡æ–°å®šä¹‰æ–°çš„ <code>renderer</code>,å†ä½¿ç”¨ä¸<code>react-route-v5</code>ç±»ä¼¼çš„ä¿®æ”¹æ–¹æ³•,å°±å¯ä»¥è¾¾åˆ°æ•ˆæœäº†.åå¤„æ˜¯éœ€è¦åŠæ—¶åŒæ­¥ä¸æ›´æ–°,æ¯”å¦‚æ–°çš„<code>react18</code>çš„ç›¸å…³èƒ½åŠ›,ä½œè€…å°±è¿˜æ²¡æœ‰æ›´æ–°ä¸Šå».</p><p><a href="https://codesandbox.io/s/05-example-umi-v3-plugin-puubqt?from-embed=&amp;file=/src/pages/list.tsx" target="_blank" rel="noopener noreferrer">åœ¨çº¿åœ°å€</a>,å¯è‡ªè¡Œè°ƒè¯•</p><h3 class="anchor anchorWithHideOnScrollNavbar_R0VQ" id="4-ä»¥åŠä½œè€…è‡ªå·±è¾ƒä¸ºæ„Ÿå…´è¶£çš„-nextjs-æ¡†æ¶">4. ä»¥åŠä½œè€…è‡ªå·±è¾ƒä¸ºæ„Ÿå…´è¶£çš„ <code>next.js</code> æ¡†æ¶<a class="hash-link" href="#4-ä»¥åŠä½œè€…è‡ªå·±è¾ƒä¸ºæ„Ÿå…´è¶£çš„-nextjs-æ¡†æ¶" title="Direct link to heading">â€‹</a></h3><p>nextjsç›¸å¯¹ç‰¹æ®Š,æ–‡ä»¶è·¯ç”±ç³»ç»Ÿæ— æ³•é€šè¿‡å¤–éƒ¨ä¿®æ”¹,å› æ­¤,è‡ªå®šä¹‰äº†_app.js,é€šè¿‡å¢åŠ  StillnessSwitchç»„ä»¶,ç®€å•çš„å°†å…¶ä¸‹çš„è·¯ç”±ç»„ä»¶å˜æˆäº†å¯é™æ­¢çš„ç»„ä»¶.</p><div class="codeBlockContainer_X7hc language-jsx theme-code-block"><div class="codeBlockContent_vqWU" style="color:#393A34;background-color:#f6f8fa"><pre tabindex="0" class="prism-code language-jsx codeBlock_wPnj thin-scrollbar"><code class="codeBlockLines_fQUY"><span class="token-line" style="color:#393A34"><span class="token keyword" style="color:#00009f">import</span><span class="token plain"> React</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"> useState</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> useEffect </span><span class="token punctuation" style="color:#393A34">}</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">from</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">'react'</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token keyword" style="color:#00009f">import</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"> useRouter </span><span class="token punctuation" style="color:#393A34">}</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">from</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">'next/router'</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token keyword" style="color:#00009f">import</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"> Offscreen </span><span class="token punctuation" style="color:#393A34">}</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">from</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">'react-stillness-component'</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token keyword" style="color:#00009f">function</span><span class="token plain"> </span><span class="token function" style="color:#d73a49">matchPath</span><span class="token punctuation" style="color:#393A34">(</span><span class="token parameter">pathname</span><span class="token parameter punctuation" style="color:#393A34">,</span><span class="token parameter"> routes</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token keyword" style="color:#00009f">const</span><span class="token plain"> result </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> routes</span><span class="token punctuation" style="color:#393A34">.</span><span class="token function" style="color:#d73a49">find</span><span class="token punctuation" style="color:#393A34">(</span><span class="token punctuation" style="color:#393A34">(</span><span class="token parameter punctuation" style="color:#393A34">{</span><span class="token parameter"> path </span><span class="token parameter punctuation" style="color:#393A34">}</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">=&gt;</span><span class="token plain"> path </span><span class="token operator" style="color:#393A34">===</span><span class="token plain"> pathname</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">||</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">null</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token keyword" style="color:#00009f">return</span><span class="token plain"> result</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token punctuation" style="color:#393A34">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token keyword" style="color:#00009f">const</span><span class="token plain"> </span><span class="token function-variable function" style="color:#d73a49">StillnessSwitch</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">(</span><span class="token parameter">props</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">=&gt;</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token keyword" style="color:#00009f">const</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"> Component</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> pageProps </span><span class="token punctuation" style="color:#393A34">}</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> props</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token keyword" style="color:#00009f">const</span><span class="token plain"> router </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> </span><span class="token function" style="color:#d73a49">useRouter</span><span class="token punctuation" style="color:#393A34">(</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token keyword" style="color:#00009f">const</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">[</span><span class="token plain">stillnessRoutes</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> setStillnessRoutes</span><span class="token punctuation" style="color:#393A34">]</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> </span><span class="token function" style="color:#d73a49">useState</span><span class="token punctuation" style="color:#393A34">(</span><span class="token punctuation" style="color:#393A34">[</span><span class="token punctuation" style="color:#393A34">]</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token keyword" style="color:#00009f">const</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">[</span><span class="token plain">route</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> setRoute</span><span class="token punctuation" style="color:#393A34">]</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> </span><span class="token function" style="color:#d73a49">useState</span><span class="token punctuation" style="color:#393A34">(</span><span class="token punctuation" style="color:#393A34">[</span><span class="token punctuation" style="color:#393A34">]</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token function" style="color:#d73a49">useEffect</span><span class="token punctuation" style="color:#393A34">(</span><span class="token punctuation" style="color:#393A34">(</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">=&gt;</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token keyword" style="color:#00009f">if</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">pageProps</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">stillness</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      </span><span class="token operator" style="color:#393A34">!</span><span class="token function" style="color:#d73a49">matchPath</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">router</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">pathname</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> stillnessRoutes</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">&amp;&amp;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token function" style="color:#d73a49">setStillnessRoutes</span><span class="token punctuation" style="color:#393A34">(</span><span class="token punctuation" style="color:#393A34">[</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">          </span><span class="token operator" style="color:#393A34">...</span><span class="token plain">stillnessRoutes</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">          </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"> </span><span class="token literal-property property" style="color:#36acaa">Page</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> Component</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> </span><span class="token literal-property property" style="color:#36acaa">_props</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> pageProps</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> </span><span class="token literal-property property" style="color:#36acaa">path</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> router</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">pathname </span><span class="token punctuation" style="color:#393A34">}</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token punctuation" style="color:#393A34">]</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      </span><span class="token function" style="color:#d73a49">setRoute</span><span class="token punctuation" style="color:#393A34">(</span><span class="token punctuation" style="color:#393A34">[</span><span class="token punctuation" style="color:#393A34">]</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token punctuation" style="color:#393A34">}</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">else</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      </span><span class="token function" style="color:#d73a49">setRoute</span><span class="token punctuation" style="color:#393A34">(</span><span class="token punctuation" style="color:#393A34">[</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">          </span><span class="token literal-property property" style="color:#36acaa">Page</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> Component</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">          </span><span class="token literal-property property" style="color:#36acaa">_props</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> pageProps</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">          </span><span class="token literal-property property" style="color:#36acaa">path</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> router</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">pathname</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token punctuation" style="color:#393A34">}</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      </span><span class="token punctuation" style="color:#393A34">]</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token punctuation" style="color:#393A34">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token punctuation" style="color:#393A34">}</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">[</span><span class="token plain">Component</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> router</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">pathname</span><span class="token punctuation" style="color:#393A34">]</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token keyword" style="color:#00009f">return</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token tag punctuation" style="color:#393A34">&lt;</span><span class="token tag punctuation" style="color:#393A34">&gt;</span><span class="token plain-text"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain-text">      </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain">stillnessRoutes</span><span class="token punctuation" style="color:#393A34">.</span><span class="token function" style="color:#d73a49">concat</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">route</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">.</span><span class="token function" style="color:#d73a49">map</span><span class="token punctuation" style="color:#393A34">(</span><span class="token punctuation" style="color:#393A34">(</span><span class="token parameter punctuation" style="color:#393A34">{</span><span class="token parameter"> Page</span><span class="token parameter punctuation" style="color:#393A34">,</span><span class="token parameter"> _props</span><span class="token parameter punctuation" style="color:#393A34">,</span><span class="token parameter"> path </span><span class="token parameter punctuation" style="color:#393A34">}</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">=&gt;</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token keyword" style="color:#00009f">if</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">_props</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">stillness</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">          </span><span class="token keyword" style="color:#00009f">return</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            </span><span class="token tag punctuation" style="color:#393A34">&lt;</span><span class="token tag class-name" style="color:#00009f">Offscreen</span><span class="token tag" style="color:#00009f"></span><br></span><span class="token-line" style="color:#393A34"><span class="token tag" style="color:#00009f">              </span><span class="token tag attr-name" style="color:#00a4db">key</span><span class="token tag script language-javascript script-punctuation punctuation" style="color:#393A34">=</span><span class="token tag script language-javascript punctuation" style="color:#393A34">{</span><span class="token tag script language-javascript" style="color:#00009f">path</span><span class="token tag script language-javascript punctuation" style="color:#393A34">}</span><span class="token tag" style="color:#00009f"></span><br></span><span class="token-line" style="color:#393A34"><span class="token tag" style="color:#00009f">              </span><span class="token tag attr-name" style="color:#00a4db">type</span><span class="token tag script language-javascript script-punctuation punctuation" style="color:#393A34">=</span><span class="token tag script language-javascript punctuation" style="color:#393A34">{</span><span class="token tag script language-javascript" style="color:#00009f">path</span><span class="token tag script language-javascript punctuation" style="color:#393A34">}</span><span class="token tag" style="color:#00009f"></span><br></span><span class="token-line" style="color:#393A34"><span class="token tag" style="color:#00009f">              </span><span class="token tag attr-name" style="color:#00a4db">visible</span><span class="token tag script language-javascript script-punctuation punctuation" style="color:#393A34">=</span><span class="token tag script language-javascript punctuation" style="color:#393A34">{</span><span class="token tag script language-javascript" style="color:#00009f">path </span><span class="token tag script language-javascript operator" style="color:#393A34">===</span><span class="token tag script language-javascript" style="color:#00009f"> router</span><span class="token tag script language-javascript punctuation" style="color:#393A34">.</span><span class="token tag script language-javascript" style="color:#00009f">pathname</span><span class="token tag script language-javascript punctuation" style="color:#393A34">}</span><span class="token tag" style="color:#00009f"></span><br></span><span class="token-line" style="color:#393A34"><span class="token tag" style="color:#00009f">            </span><span class="token tag punctuation" style="color:#393A34">&gt;</span><span class="token plain-text"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain-text">              </span><span class="token tag punctuation" style="color:#393A34">&lt;</span><span class="token tag class-name" style="color:#00009f">Page</span><span class="token tag" style="color:#00009f"> </span><span class="token tag spread punctuation" style="color:#393A34">{</span><span class="token tag spread operator" style="color:#393A34">...</span><span class="token tag spread" style="color:#00009f">_props</span><span class="token tag spread punctuation" style="color:#393A34">}</span><span class="token tag" style="color:#00009f"> </span><span class="token tag punctuation" style="color:#393A34">/&gt;</span><span class="token plain-text"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain-text">            </span><span class="token tag punctuation" style="color:#393A34">&lt;/</span><span class="token tag class-name" style="color:#00009f">Offscreen</span><span class="token tag punctuation" style="color:#393A34">&gt;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">          </span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token punctuation" style="color:#393A34">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token keyword" style="color:#00009f">return</span><span class="token plain"> </span><span class="token tag punctuation" style="color:#393A34">&lt;</span><span class="token tag class-name" style="color:#00009f">Page</span><span class="token tag" style="color:#00009f"> </span><span class="token tag spread punctuation" style="color:#393A34">{</span><span class="token tag spread operator" style="color:#393A34">...</span><span class="token tag spread" style="color:#00009f">_props</span><span class="token tag spread punctuation" style="color:#393A34">}</span><span class="token tag" style="color:#00009f"> </span><span class="token tag punctuation" style="color:#393A34">/&gt;</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      </span><span class="token punctuation" style="color:#393A34">}</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">}</span><span class="token plain-text"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain-text">    </span><span class="token tag punctuation" style="color:#393A34">&lt;/</span><span class="token tag punctuation" style="color:#393A34">&gt;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token punctuation" style="color:#393A34">}</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token keyword" style="color:#00009f">export</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">default</span><span class="token plain"> StillnessSwitch</span><span class="token punctuation" style="color:#393A34">;</span><br></span></code></pre><button type="button" aria-label="Copy code to clipboard" title="Copy" class="copyButton_eDfN clean-btn"><span class="copyButtonIcons_W9eQ" aria-hidden="true"><svg class="copyButtonIcon_XEyF" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_i9w9" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div><p><img loading="lazy" alt="nextjs demo" src="/react-stillness-component/zh-CN/assets/images/9-3998556bb2133902ffc3891635e916bf.gif" width="796" height="490" class="img_E7b_"></p><p><a href="https://codesandbox.io/s/06-example-nextjs-kwcu20?from-embed=&amp;file=/pages/index.js" target="_blank" rel="noopener noreferrer">åœ¨çº¿åœ°å€</a>,å¯è‡ªè¡Œè°ƒè¯•</p><h2 class="anchor anchorWithHideOnScrollNavbar_R0VQ" id="æ€»ç»“">æ€»ç»“<a class="hash-link" href="#æ€»ç»“" title="Direct link to heading">â€‹</a></h2><p>æœ¬æ–‡è¯¦ç»†ä»‹ç»äº†åœ¨reactä¸­å¦‚ä½•å®ç°<code>keep-alive</code>çš„æ•ˆæœ,å¹¶è¯¦ç»†æè¿°äº†å…·ä½“æ€è·¯,ä½œè€…ä¸€å¼€å§‹å…¶å®æ˜¯å¸Œæœ›ä»‹ç»ç»„ä»¶çš„è‡ªåŠ¨åŒ–æµ‹è¯•ç›¸å…³,åé¢å®é™…åœºæ™¯ä¸­é‡åˆ°äº†è¿™ä¸ªéœ€æ±‚,é‚£ç´¢æ€§å°±å…ˆæŠŠç»„ä»¶å®ç°,ä¹‹åå†ç”¨å®é™…çš„ç»„ä»¶æ¥å®Œæˆå‰ç«¯æµ‹è¯•.è¿™æ˜¯ ã€Šå‰ç«¯å¦‚ä½•åšç»„ä»¶æµ‹è¯•ã€‹çš„å‰ç½®ç¯‡,å¦‚æœæœ‰ä»»ä½•é—®é¢˜,æ¬¢è¿è®¨è®º.</p>]]></content>
        <author>
            <name>leomYili</name>
            <uri>https://github.com/leomYili</uri>
        </author>
        <category label="keep-alive" term="keep-alive"/>
        <category label="react-stillness-component" term="react-stillness-component"/>
    </entry>
    <entry>
        <title type="html"><![CDATA[ç”¨BDDçš„æ€æƒ³åšç»„ä»¶æµ‹è¯•]]></title>
        <id>bdd-test</id>
        <link href="https://leomyili.github.io/react-stillness-component/zh-CN/blog/bdd-test"/>
        <updated>2022-07-31T13:30:00.000Z</updated>
        <summary type="html"><![CDATA[è¿™æ˜¯æˆ‘å…³äºå‰ç«¯è‡ªåŠ¨åŒ–æµ‹è¯•çš„ç¬¬äºŒç¯‡åšæ–‡ã€‚]]></summary>
        <author>
            <name>leomYili</name>
            <uri>https://github.com/leomYili</uri>
        </author>
        <category label="BDD" term="BDD"/>
        <category label="test" term="test"/>
    </entry>
</feed>